<!DOCTYPE html>
<html lang="zh-CN" class="no-js">
<head>
	<meta charset="UTF-8">
	<base href="https://www.biglee.cn/">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="profile" href="http://gmpg.org/xfn/11">
		<script>(function(html){html.className = html.className.replace(/\bno-js\b/,'js')})(document.documentElement);</script>
<title>Lee &#8211; 第18页 &#8211; 网站建设技术集锦</title>
<link rel='dns-prefetch' href='//s.w.org'>
<link rel="alternate" type="application/rss+xml" title="网站建设技术集锦 &raquo; Feed" href="/feed" />
<link rel="alternate" type="application/rss+xml" title="网站建设技术集锦 &raquo; 评论Feed" href="/comments/feed" />
<link rel="alternate" type="application/rss+xml" title="网站建设技术集锦 &raquo; 由Lee发表的文章Feed" href="/blog/author/lee/feed" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='genericons-css'  href='/wp-content/themes/twentysixteen/genericons/genericons.css?ver=3.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='twentysixteen-style-css'  href='/wp-content/themes/twentysixteen/style.css?ver=4.6' type='text/css' media='all' />
<!--[if lt IE 10]>
<link rel='stylesheet' id='twentysixteen-ie-css'  href='/wp-content/themes/twentysixteen/css/ie.css?ver=20160816' type='text/css' media='all' />
<![endif]-->
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentysixteen-ie8-css'  href='/wp-content/themes/twentysixteen/css/ie8.css?ver=20160816' type='text/css' media='all' />
<![endif]-->
<!--[if lt IE 8]>
<link rel='stylesheet' id='twentysixteen-ie7-css'  href='/wp-content/themes/twentysixteen/css/ie7.css?ver=20160816' type='text/css' media='all' />
<![endif]-->
<!--[if lt IE 9]>
<script type='text/javascript' src='/wp-content/themes/twentysixteen/js/html5.js?ver=3.7.3'></script>
<![endif]-->
<script type='text/javascript' src='/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.6" />
		<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
		</head>

<body class="archive paged author author-lee author-1 paged-18 author-paged-18 hfeed">
<div id="page" class="site">
	<div class="site-inner">
		<a class="skip-link screen-reader-text" href="#content">跳至内容</a>

		<header id="masthead" class="site-header" role="banner">
			<div class="site-header-main">
				<div class="site-branding">
					
											<p class="site-title"><a href="/" rel="home">网站建设技术集锦</a></p>
											<p class="site-description">涉及网站建设、服务器维护等IT技术的博客</p>
									</div><!-- .site-branding -->

									<button id="menu-toggle" class="menu-toggle">菜单</button>

					<div id="site-header-menu" class="site-header-menu">
													<nav id="site-navigation" class="main-navigation" role="navigation" aria-label="主菜单">
								<div class="menu-%e5%af%bc%e8%88%aa-container"><ul id="menu-%e5%af%bc%e8%88%aa" class="primary-menu"><li id="menu-item-309" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-309"><a href="/blog/category/web_development">网站技术</a></li>
<li id="menu-item-310" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-310"><a href="/blog/category/pc_technology">PC技术</a></li>
<li id="menu-item-311" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-311"><a href="/blog/category/orther">杂货铺</a></li>
<li id="menu-item-312" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-312"><a href="/blog/category/entertainment">影音娱乐</a></li>
<li id="menu-item-313" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-313"><a href="/blog/category/life">网络生活</a></li>
<li id="menu-item-314" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-314"><a href="/blog/category/digest">文摘</a></li>
<li id="menu-item-315" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-315"><a href="/blog/category/database">数据库</a></li>
<li id="menu-item-316" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-316"><a href="/blog/category/network">网络安全</a></li>
<li id="menu-item-317" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-317"><a href="/blog/category/management">管理营运</a></li>
<li id="menu-item-318" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-318"><a href="/blog/category/dotnet">.Net</a></li>
<li id="menu-item-323" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-323"><a href="/about_me">关于我</a></li>
</ul></div>							</nav><!-- .main-navigation -->
						
											</div><!-- .site-header-menu -->
							</div><!-- .site-header-main -->

					</header><!-- .site-header -->

		<div id="content" class="site-content">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			<header class="page-header">
				<h1 class="page-title">作者：<span class="vcard">Lee</span></h1>			</header><!-- .page-header -->

			
<article id="post-127" class="post-127 post type-post status-publish format-standard hentry category-dotnet">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="/blog/2008/127.html" rel="bookmark">.NET Framework 开发人员指南 之 使用连接池</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>　　连接到数据库服务器通常由几个需要很长时间的步骤组成。必须建立物理通道（例如套接字或命名管道），必须与服务器进行初次握手，必须分析连接字符串信息，必须由服务器对连接进行身份验证，必须运行检查以便在当前事务中登记，等等。 </p>
<p>　　实际上，大多数应用程序仅使用一个或几个不同的连接配置。这意味着在执行应用程序期间，许多相同的连接将反复地打开和关闭。为了使打开的连接成本最低，ADO.NET 使用称为<strong>连接池</strong>的优化方法。</p>
<p>　　连接池减少新连接需要打开的次数。<strong>池进程</strong>保持物理连接的所有权。通过为每个给定的连接配置保留一组活动连接来管理连接。只要用户在连接上调用 Open，池进程就会检查池中是否有可用的连接。如果某个池连接可用，会将该连接返回给调用者，而不是打开新连接。应用程序在该连接上调用 Close 时，池进程会将连接返回到活动连接池集中，而不是真正关闭连接。连接返回到池中之后，即可在下一个 Open 调用中重复使用。</p>
<p>　　只有配置相同的连接可以建立池连接。ADO.NET 同时保留多个池，每个配置一个池。连接由连接字符串以及 Windows 标识（在使用集成的安全性时）分为多个池。</p>
<p>　　池连接可以大大提高应用程序的性能和可缩放性。默认情况下，ADO.NET 中启用连接池。除非显式禁用，否则，连接在应用程序中打开和关闭时，池进程将对连接进行优化。还可以提供几个连接字符串修饰符来控制连接池的行为。有关更多信息，请参见本主题后面的&amp;ldquo;使用连接字符串关键字控制连接池&amp;rdquo;。</p>
<h1 class="heading">池的创建和分配</h1>
<div class="seeAlsoNoToggleSection" id="sectionSection0">
<p>　　在初次打开连接时，将根据完全匹配算法创建连接池，该算法将池与连接中的连接字符串关联。每个连接池与不同的连接字符串关联。打开新连接时，如果连接字符串并非与现有池完全匹配，将创建一个新池。按进程、按应用程序域、按连接字符串以及（在使用集成的安全性时）按 Windows 标识来建立池连接。</p>
<p>　　在以下 C# 示例中创建了三个新的 <a id="ctl00_rs1_mainContentContainer_ctl01" onclick="javascript:Track(&#39;ctl00_rs1_mainContentContainer_ctl00|ctl00_rs1_mainContentContainer_ctl01&#39;,this);" href="http://msdn.microsoft.com/zh-cn/library/system.data.sqlclient.sqlconnection(VS.80).aspx">SqlConnection</a> 对象，但是管理时只需要两个连接池。注意，根据为 <tt>Initial Catalog</tt> 分配的值，第一个和第二个连接字符串有所不同。</p>
<div class="" id="ctl00_rs1_mainContentContainer_ctl02_other">
<div class="CodeSnippetTitleBar">
<div class="CodeDisplayLanguage">&amp;nbsp;</div>
<div class="CopyCodeButton">using (SqlConnection connection = new SqlConnection(<br />&amp;nbsp; &amp;quot;Integrated Security=SSPI;Initial Catalog=Northwind&amp;quot;))<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; {<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connection.Open();&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Pool A is cr&#101;ated.<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; }</p>
<p>using (SqlConnection connection = new SqlConnection(<br />&amp;nbsp; &amp;quot;Integrated Security=SSPI;Initial Catalog=pubs&amp;quot;))<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; {<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connection.Open();&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Pool B is cr&#101;ated because the connection strings differ.<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; }</p>
<p>using (SqlConnection connection = new SqlConnection(<br />&amp;nbsp; &amp;quot;Integrated Security=SSPI;Initial Catalog=Northwind&amp;quot;))<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; {<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connection.Open();&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // The connection string matches pool A.<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; }</div>
</div>
</div>
<p>　　如果 MinPoolSize 在连接字符串中未指定或指定为零，池中的连接将在一段时间不活动后关闭。但是，如果指定的 MinPoolSize 大于零，在 AppDomain 被卸载并且进程结束之前，连接池不会被破坏。非活动或空池的维护只需要最少的系统开销。</p>
<div class="alert">
<table width="100%">
<tbody>
<tr>
<th align="left"><img class="note" alt="Note" src="http://msdn.microsoft.com/zh-cn/library/8xx3tyca.note(zh-cn,VS.80).gif" />注意</th>
</tr>
<tr>
<td>
<p>如果发生致命错误（例如故障转移或注册表中的别名更改），池将自动清除。</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<h1 class="heading">添加连接</h1>
<div class="seeAlsoNoToggleSection" id="sectionSection1">
<p>　　连接池是为每个唯一的连接字符串创建的。当创建一个池后，将创建多个连接对象并将其添加到该池中，以满足最小池大小的要求。连接根据需要添加到池中，但是不能超过指定的最大池大小（默认值为 100）。连接在关闭或断开时释放回池中。 </p>
<p>　　在请求 SqlConnection 对象时，如果存在可用的连接，将从池中获取该对象。连接要可用，必须未使用，具有匹配的事务上下文或未与任何事务上下文关联，并且具有与服务器的有效链接。</p>
<p>　　连接池进程通过在连接释放回池中时重新分配连接，来满足这些连接请求。如果已达到最大池大小且不存在可用的连接，则该请求将会排队。然后，池进程尝试重新建立任何连接，直到到达超时时间（默认值为 15 秒）。如果池进程在连接超时之前无法满足请求，将引发异常。 </p>
<div class="alert">
<table width="100%">
<tbody>
<tr>
<th align="left"><img class="note" alt="Caution note" src="http://msdn.microsoft.com/zh-cn/library/8xx3tyca.Caution(zh-cn,VS.80).gif" />警告</th>
</tr>
<tr>
<td>
<p>我们建议您在使用完连接时一定要关闭连接，以便连接可以返回池。要关闭连接，可以使用 Connection 对象的 Close 或 Dispose 方法，也可以通过在 C# 的 using 语句中或在 Visual Basic 的 Using 语句中打开所有连接。不是显式关闭的连接可能不会添加或返回到池中。例如，如果连接已超出范围但没有显式关闭，则仅当达到最大池大小而该连接仍然有效时，该连接才会返回到连接池中。有关更多信息，请参见 Visual Basic 的<a id="ctl00_rs1_mainContentContainer_ctl03" onclick="javascript:Track(&#39;ctl00_rs1_mainContentContainer_ctl00|ctl00_rs1_mainContentContainer_ctl03&#39;,this);" href="http://msdn.microsoft.com/zh-cn/library/yh598w02(VS.80).aspx">using 语句（C# 参考）</a>或<a id="ctl00_rs1_mainContentContainer_ctl04" onclick="javascript:Track(&#39;ctl00_rs1_mainContentContainer_ctl00|ctl00_rs1_mainContentContainer_ctl04&#39;,this);" href="http://msdn.microsoft.com/zh-cn/library/wydd5hkd(VS.80).aspx">如何：释放系统资源</a>。</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="alert">
<table width="100%">
<tbody>
<tr>
<th align="left"><img class="note" alt="Note" src="http://msdn.microsoft.com/zh-cn/library/8xx3tyca.note(zh-cn,VS.80).gif" />注意</th>
</tr>
<tr>
<td>
<p>不要在类的 Finalize 方法中对 Connection、DataReader 或任何其他托管对象调用 Close 或 Dispose。在终结器中，仅释放类直接拥有的非托管资源。如果类不拥有任何非托管资源，则不要在类定义中包含 Finalize 方法。有关更多信息，请参见<a id="ctl00_rs1_mainContentContainer_ctl05" onclick="javascript:Track(&#39;ctl00_rs1_mainContentContainer_ctl00|ctl00_rs1_mainContentContainer_ctl05&#39;,this);" href="http://msdn.microsoft.com/zh-cn/library/0xy59wtx(VS.80).aspx">垃圾回收</a>。</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<h1 class="heading">移除连接</h1>
<div class="seeAlsoNoToggleSection" id="sectionSection2">
<p>　　连接池进程定期扫描连接池，查找没有通过 Close 或 Dispose 关闭的未用连接，并重新建立找到的连接。如果应用程序没有显式关闭或断开其连接，连接池进程可能需要很长时间才能重新建立连接，所以，最好确保在连接中显式调用 Close 和 Dispose。</p>
<p>　　如果连接长时间空闲，或池进程检测到与服务器的连接已断开，连接池进程会将该连接从池中移除。注意，只有在尝试与服务器进行通信之后才能检测到断开的连接。如果发现某连接不再连接到服务器，则会将其标记为无效。无效连接只有在关闭或重新建立后，才会从连接池中移除。</p>
<p>　　如果存在与已消失的服务器的连接，那么即使连接池管理程序未检测到已断开的连接并将其标记为无效，仍有可能将此连接从池中取出。这种情况是因为检查连接是否仍有效的系统开销将造成与服务器的另一次往返，从而抵消了池进程的优势。发生此情况时，初次尝试使用该连接将检测连接是否曾断开，并引发异常。</p>
</div>
<h1 class="heading">清除池</h1>
<div class="seeAlsoNoToggleSection" id="sectionSection3">
<p>　　ADO.NET 2.0 引入了两种新的方法来清除池：<a id="ctl00_rs1_mainContentContainer_ctl06" onclick="javascript:Track(&#39;ctl00_rs1_mainContentContainer_ctl00|ctl00_rs1_mainContentContainer_ctl06&#39;,this);" href="http://msdn.microsoft.com/zh-cn/library/system.data.sqlclient.sqlconnection.clearallpools(VS.80).aspx">ClearAllPools</a> 和 <a id="ctl00_rs1_mainContentContainer_ctl07" onclick="javascript:Track(&#39;ctl00_rs1_mainContentContainer_ctl00|ctl00_rs1_mainContentContainer_ctl07&#39;,this);" href="http://msdn.microsoft.com/zh-cn/library/system.data.sqlclient.sqlconnection.clearpool(VS.80).aspx">ClearPool</a>。ClearAllPools 清除给定提供程序的连接池，ClearPool 清除与特定连接关联的连接池。如果在调用时连接正在使用，将进行相应的标记。连接关闭时，将被丢弃，而不是返回池中。</p>
</div>
<h1 class="heading">事务支持</h1>
<div class="seeAlsoNoToggleSection" id="sectionSection4">
<p>　　连接是根据事务上下文来从池中取出并进行分配的。除非在连接字符串中指定了 <tt>Enlist=false</tt>，否则，连接池将确保连接在 <a id="ctl00_rs1_mainContentContainer_ctl08" onclick="javascript:Track(&#39;ctl00_rs1_mainContentContainer_ctl00|ctl00_rs1_mainContentContainer_ctl08&#39;,this);" href="http://msdn.microsoft.com/zh-cn/library/system.transactions.transaction.current(VS.80).aspx">Current</a> 上下文中登记。如果连接使用登记的 System.Transactions 事务关闭并返回池中，连接将保留在池中，以便使用相同 System.Transactions 事务对该连接池的下一次请求将返回相同的连接。如果该事务没有可用连接，在该连接打开时，将自动注册该连接。</p>
<p>　　当连接关闭时，它将被释放回池中，并根据其事务上下文放入相应的子部分。因此，即使分布式事务仍然挂起，仍可以关闭该连接而不会生成错误。这样，您就可以在随后提交或中止分布式事务。</p>
</div>
<h1 class="heading">使用连接字符串关键字控制连接池</h1>
<div class="seeAlsoNoToggleSection" id="sectionSection5">
<p>　　SqlConnection 对象的 ConnectionString 属性支持连接字符串键/值对，可以用于调整连接池逻辑的行为。有关更多信息，请参见 <a id="ctl00_rs1_mainContentContainer_ctl09" onclick="javascript:Track(&#39;ctl00_rs1_mainContentContainer_ctl00|ctl00_rs1_mainContentContainer_ctl09&#39;,this);" href="http://msdn.microsoft.com/zh-cn/library/system.data.sqlclient.sqlconnection.connectionstring(VS.80).aspx">ConnectionString</a>。</p>
</div>
<h1 class="heading">池碎片</h1>
<div class="seeAlsoNoToggleSection" id="sectionSection6">
<p>　　池碎片是许多 Web 应用程序中的一个常见问题，应用程序可能会创建大量在进程退出后才会释放的池。这样，将打开大量的连接，占用许多内存，从而影响性能。</p>
<h3 class="subHeading">因为集成安全性产生的池碎片</h3>
<div class="subSection">
<p>　　连接根据连接字符串以及用户标识来建立池连接。因此，如果使用网站上的基本身份验证或 Windows 身份验证以及集成的安全登录，每个用户将获得一个池。尽管这样可以提高单个用户的后续数据库请求的性能，但是该用户无法利用其他用户建立的连接。这样还使每个用户至少产生一个与数据库服务器的连接。这对特定 Web 应用程序结构会产生副作用，因为开发人员需要衡量安全性和审计要求。</p>
</div>
<h3 class="subHeading">因为许多数据库产生的池碎片</h3>
<div class="subSection">
<p>　　许多 Internet 服务提供商在一台服务器上托管多个网站。他们可能使用单个数据库确认窗体身份验证登录，然后为该用户或用户组打开与特定数据库的连接。与身份验证数据库的连接将建立池连接，供每个用户使用。但是，每个数据库的连接存在一个独立的池，因此增加了与服务器的连接数。</p>
<p>　　这也会对应用程序设计产生副作用。但是，可以通过一个相对简单的方式避免此副作用，而又不会影响连接 SQL Server 时的安全性。不是为每个用户或组连接独立的数据库，而是连接到服务器上的相同数据库，然后执行 Transact-SQL USE 语句来切换为所需的数据库。以下代码段演示入如何创建与 master 数据库的初始连接，然后切换到 <tt>databaseName</tt> 字符串变量中指定的所需数据库。 </p>
<div class="libCScode" id="ctl00_rs1_mainContentContainer_ctl10_VisualBasic" style="DISPLAY: none">
<div class="CodeSnippetTitleBar">
<div class="CodeDisplayLanguage">Visual Basic</div>
</div>
<pre class="libCScode" id="ctl00_rs1_mainContentContainer_ctl10VisualBasic" space="preserve"><span style="COLOR: green">&#39; Assumes that command is a valid SqlCommand object.</span>
Using connection <span style="COLOR: blue">As</span> <span style="COLOR: blue">New</span> SqlConnection( _
<span style="COLOR: maroon">&amp;quot;Server=MSSQL1;uid=xxx;pwd=xxx;database=master&amp;quot;</span>)
connection.Open()
command.ExecuteNonQuery(<span style="COLOR: maroon">&amp;quot;USE &amp;quot;</span> &amp;amp; databaseName)
<span style="COLOR: blue">End</span> Using</pre>
</div>
<div class="libCScode" id="ctl00_rs1_mainContentContainer_ctl11_CSharp">
<div class="CodeSnippetTitleBar">
<div class="CodeD 	</div><!-- .entry-content -->	<footer class=">
		<span class="byline"><span class="author vcard"><img alt='' src='http://2.gravatar.com/avatar/b9f7391bdaee9d0a30a3fda8ddd6436e?s=49&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/b9f7391bdaee9d0a30a3fda8ddd6436e?s=98&amp;d=mm&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">作者 </span> <a class="url fn n" href="/blog/author/lee">Lee</a></span></span><span class="posted-on"><span class="screen-reader-text">发布于 </span><a href="/blog/2008/127.html" rel="bookmark"><time class="entry-date published" datetime="2008-06-23T10:07:13+00:00">2008年6月23日</time><time class="updated" datetime="-001-11-30T00:00:00+00:00">-0001年11月30日</time></a></span><span class="cat-links"><span class="screen-reader-text">分类 </span><a href="/blog/category/dotnet" rel="category tag">.Net</a></span><span class="comments-link"><a href="/blog/2008/127.html#respond"><span class="screen-reader-text">于.NET Framework 开发人员指南 之 使用连接池</span>留下评论</a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-126" class="post-126 post type-post status-publish format-standard hentry category-dotnet">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="/blog/2008/126.html" rel="bookmark">ADO.NET 2.0技术内幕 之 连接池</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<h3>&amp;nbsp;连&amp;nbsp; 接&amp;nbsp; 池</h3>
<p class="MsoNormal" style="TEXT-INDENT: 21pt">与微软以前的数据访问技术类似，ADO.NET包括对连接池的内置支持。</p>
<h3 style="LINE-HEIGHT: 16.5pt">1&amp;nbsp; 连接句柄和物理连接</h3>
<p class="MsoNormal" style="TEXT-INDENT: 21pt; LINE-HEIGHT: 16.5pt">如果正在使用Visual Studio，可以使用Visual Studio调试工具检查对象的一些内部私有属性。例如，编写一些代码来打开一个SqlConnection，并在调用Open方法的地方设置断点。右击代码中的对象，并选择【添加监视】，将该对象添加到【监视】窗口。在【监视】窗口中，展开标有Non-Pubic Members的区域。向下滚动，将会看到一个称为InnerConnection的私有属性。</p>
<p class="MsoNormal" style="TEXT-INDENT: 21pt; LINE-HEIGHT: 16.5pt">从结构上讲，InnerConnection属性的内容是一个非常薄的层，位于数据库的物理连接之上。为在这里进行讨论，InnerConnection属性和到该数据库的物理连接是可交换的。在逐步执行代码时，将会看到在打开和关闭连接时，InnerConnection属性的值发生变化。当调用Open方法时，SQL Client .NET数据提供程序将SqlConnection对象关联至该数据库的物理连接，所以可以执行查询并返回结果。</p>
<p class="MsoNormal" style="TEXT-INDENT: 21pt; LINE-HEIGHT: 16.5pt">打开和关闭数据库连接的代价非常高。为了帮助节省资源并提高性能，.NET Framework中的.NET数据提供程序在默认情况下均使用连接池。</p>
<h3 style="LINE-HEIGHT: 16.5pt">2&amp;nbsp; 连接池是什么</h3>
<p class="MsoNormal" style="TEXT-INDENT: 21pt; LINE-HEIGHT: 16.5pt">连接池是一种在打开数据存储区的连接时提高应用程序性能的机制。在调用SqlConnection对象的Close方法时，SQL Client .NET数据提供程序并不实际关闭内部连接。相反，数据提供程序将该内部连接存储到一个池中，以便在以后再次使用。甚至在SqlConnection对象被处理之后，该内部连接也保留在池中。如果在以后使用相同连接字符串和凭据调用SqlConnection对象的Open方法，将会再次使用同一内部连接与数据库进行通信。</p>
<p class="MsoNormal" style="TEXT-INDENT: 21pt; LINE-HEIGHT: 16.5pt">如果希望确认是否真正再次利用了同一内部连接，可以使用.NET Reflection中的功能以可编程方式访问私有InnerConnection属性的内容。以下代码(其需要对System.Reflection命名空间的引用)在Using代码块中打开一个SqlConnection，并存储SqlConnection的InnerConnection属性的值。通过利用Using代码块，在该代码块的末尾隐式处理了SqlConnection。此代码在Using代码块中打开另一个SqlConnection，并存储SqlConnection的InnerConnection属性的值。最后，此代码对比InnerConnection属性的内容，确认它们实际上为同一对象。</p>
<p class="a7">Visual Basic</p>
<p class="ab" style="MARGIN-LEFT: 21pt">Dim strConn As String = &amp;quot;Data Source=.SQLExpress;Integrated Security=True;&amp;quot;<br />Dim propInnerConn As PropertyInfo<br />propInnerConn = GetType(SqlConnection).GetProperty(&amp;quot;InnerConnection&amp;quot;, _<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;BindingFlags.NonPublic o&#114; BindingFlags.Instance)<br />Dim objInnerConn1, objInnerConn2 As Object<br />Using cn As New SqlConnection(strConn)<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; cn.Open()<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; objInnerConn1 = propInnerConn.GetValue(cn, Nothing)<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; cn.Close()<br />End Using</p>
<p class="ab" style="MARGIN-LEFT: 21pt">Using cn As New SqlConnection(strConn)<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; cn.Open()<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; objInnerConn2 = propInnerConn.GetValue(cn, Nothing)<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; cn.Close()<br />End Using</p>
<p class="ab" style="MARGIN-LEFT: 21pt">Console.WriteLine(objInnerConn1 Is objInnerConn2)</p>
<p class="a7">Visual C#</p>
<p class="ab" style="MARGIN-LEFT: 21pt">string strConn = @&amp;quot;Data Source=.SQLExpress;Integrated Security=True;&amp;quot;;<br />PropertyInfo propInnerConn;<br />propInnerConn = typeof(SqlConnection).GetProperty(&amp;quot;InnerConnection&amp;quot;,<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;BindingFlags.NonPublic | BindingFlags.Instance);<br />object objInnerConn1, objInnerConn2;<br />using (SqlConnection cn = new SqlConnection(strConn))<br />{<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; cn.Open();<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; objInnerConn1 = propInnerConn.GetValue(cn, null);<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; cn.Close();<br />}</p>
<p class="ab" style="MARGIN-LEFT: 21pt">using (SqlConnection cn = new SqlConnection(strConn))<br />{<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; cn.Open();<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; objInnerConn2 = propInnerConn.GetValue(cn, null);<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; cn.Close();<br />}</p>
<p class="ab" style="MARGIN-LEFT: 21pt">Console.WriteLine(objInnerConn1 == objInnerConn2);</p>
<p class="MsoNormal" style="TEXT-INDENT: 21pt; LINE-HEIGHT: 16.5pt">两个SqlConnection对象是在不同的Using代码块中创建的，所以其资源将在每个Using代码块的末尾被清除。InnerConnection属性的内容及其所封装的物理连接没有被处理，而是存储在池中，以便在以后被再次利用。</p>
<p class="MsoList2" style="MARGIN: 6pt 0cm 6pt 52.5pt; TEXT-INDENT: -52.5pt; LINE-HEIGHT: 16.5pt"><sub><img height="27" alt="" src="http://book.csdn.net/BookFiles/396/img/image026.jpg" width="18" /></sub>&amp;nbsp;注意&amp;nbsp;&amp;nbsp;&amp;nbsp; 如果在连接字符串中禁用了连接池(稍后将解释如何禁用)，将会看到此内部连接不能被重复利用。</p>
<h3 style="LINE-HEIGHT: 16.5pt">3&amp;nbsp; 连接池如何改进代码</h3>
<p class="MsoNormal" style="TEXT-INDENT: 21pt; LINE-HEIGHT: 16.5pt">考虑一个访问SQL Server数据库的典型ASP.NET或WebServices应用程序。客户端应用程序每次需要查询数据库时，就会在服务器端代码中进行往返，以打开SqlConnection来执行查询。在许多此类应用程序中，这一代码以相同凭据一次又一次地连接到相同数据库。理论上，这意味着客户端应用程序每次需要执行查询时，服务器端代码需要执行三个操 作&amp;mdash;&amp;mdash;登录到数据库(需要检查所提供的凭据)、执行查询、然后注销。</p>
<p class="MsoNormal" style="TEXT-INDENT: 21pt; LINE-HEIGHT: 16.5pt">连接池可以真正地提高此类应用程序的性能。通过将内部连接存储在池中，并在以后进行重复利用，就不再因为登录数据库以及从中注销而降低性能。对SqlConnection对象的Open和Close方法的调用可以短时间内返回，从而可以提高代码的性能和响应速度(请参见图3.4)。</p>
<p align="center"><img height="298" alt="" src="http://book.csdn.net/BookFiles/396/img/image030.jpg" width="379" /></p>
<p align="center">图3.4&amp;nbsp; 典型ASP.NET或WebServices应用程序中的连接池</p>
<h3>4&amp;nbsp; 启用连接池</h3>
<p class="MsoNormal" style="TEXT-INDENT: 21pt">在ADO.NET中，连接池是默认启用的。以下代码段将同一SqlConnection对象打开和关闭5次。由于连接池是默认启用的，所以当调用Close方法时，到数据库的实际连接没有被实际关闭，而是将该数据库连接发送到池中，以便在以后重复利用。</p>
<p class="a7">Visual Basic</p>
<p class="ab" style="MARGIN-LEFT: 21pt">Dim strConn As String<br />strConn = &amp;quot;Data Source=.SQLExpress;Integrated Security=True;&amp;quot;<br />Dim cn As New SqlConnection(strConn)<br />For intCounter As Integer = 1 To 5<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; cn.Open()<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; cn.Close()<br />Next intCounter</p>
<p class="ab" style="MARGIN-LEFT: 21pt">Visual C#</p>
<p class="ab" style="MARGIN-LEFT: 21pt">string strConn;<br />strConn = @&amp;quot;Data Source=.SQLExpress;Integrated Security=True;&amp;quot;;<br />SqlConnection cn = new SqlConnection(strConn);<br />for (int intCounter = 1; intCounter &amp;lt;= 5; intCounter++)<br />{&amp;nbsp;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; cn.Open();<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; cn.Close();<br />}</p>
<h3>5&amp;nbsp; 放入池中的连接何时关闭</h3>
<p class="MsoNormal" style="TEXT-INDENT: 21pt">在调用Close方法时，SqlClient将该连接返回到池中。假定该连接没有被再次使用，将在大约5分钟后将其从池中删除。但具体在多少秒后删除，并没有确切的数值。其行为取决于所生成的随机数以及创建该池时的相对湿度(relative humidity)。当然，如果在退出应用程序时存在已打开的连接池，那么作为应用程序正常清除过程的一部分，这些连接将被关闭和处理。</p>
<h3>6&amp;nbsp; 禁用连接池</h3>
<p class="MsoNormal" style="TEXT-INDENT: 21pt">您可能不希望使用连接池。例如，如果正在使用一个直接与数据库进行通信的简单Windows应用程序，那么可能希望禁用连接池。在采用这一架构时，各个客户端应用程序需要自己的连接。在启用连接池时，每个应用程序的连接被放入池中，如果在清除连接池之前重新打开该连接，将重复利用放入池中的连接。所以，如果应用程序频繁重复使用连接，那么在启用连接池的情况下，对SqlConnection.Open的调用将会更快速地返回。但是，这种方法将会导致在任意给定时刻存在许多活动的数据库连接。禁用连接池将会降低任意时刻的活动数据库连接数目，但这样会强制所有对SqlConnection.Open的调用都建立一个新的数据库连接。</p>
<p class="MsoNormal" style="TEXT-INDENT: 21pt">如果希望禁用连接池，可以通过向连接字符串中添加Pooling=False，逐个连接地禁用连接池。</p>
<p class="MsoNormal" style="TEXT-INDENT: 21pt">幸运的是，在ADO.NET 2.0中不再需要记忆诸如此类的属性。如果存在疑问，可以检查SqlConnectionStringBuilder类的选项。在这个类中可以找到一个Pooling属性，其取值为Boolean类型。默认情况下，此值被设置为True。将该值设置为False将会禁止将该连接放入池中。因此，在调用SqlConnection对象的Close方法时，将会关闭与数据库的实际连接。</p>
<p class="MsoList2" style="MARGIN: 6pt 0cm 6pt 52.5pt; TEXT-INDENT: -52.5pt"><sub><img height="27" alt="" src="http://book.csdn.net/BookFiles/396/img/image005.jpg" width="18" /></sub>&amp;nbsp;注意&amp;nbsp;&amp;nbsp;&amp;nbsp; 在&amp;ldquo;偶尔进行连接&amp;rdquo;的Windows应用程序中，使用连接池可能很有帮助，具体取决于应用程序。如果应用程序希望定期重新连接到数据库，则可以发挥连接池的作用，将与数据库的物理连接保持打开状态，至少暂时如此。如果在从池中删除该物理连接之前，应用程序尝试重新连接到该数据库，则连接池逻辑(pooling logic)将会重新使用与该数据库的物理连接。</p>
<h3>7&amp;nbsp; 有关连接池的常见问题</h3>
<p class="MsoNormal" style="TEXT-INDENT: 21pt">学习连接池的开发人员越多，出现的问题也会越多。例如，在我听到的连接池相关问题中，最常见的一个是&amp;ldquo;我怎样才能知道与数据库的物理连接是被真正关闭了，还是仅仅被放入池中了？&amp;rdquo;，另一个常见问题是&amp;ldquo;我怎样才能分辨刚刚打开的连接是建立了一个新物理连接，还是重新利用了一个被放在池中的连接？&amp;rdquo;。</p>
<p class="MsoNormal" style="TEXT-INDENT: 21pt">有许多工具可以帮助回答有关连接池的问题。其中一些工具更出色一些。我定期使用SQL Server事件探查器来监视对SQL Server数据库的连接和查询。在ADO.NET的2.0版中，还可以使用Windows中的【性能监视器】。</p>
<p class="MsoNormal" style="TEXT-INDENT: 21pt">ADO.NET 2.0中的SQL Client .NET数据提供程序包括用于连接池的性能计数器。现在可以使用诸如【性能监视器】等工具来查看以下数目：放入池中的连接、活动连接、自由连接、活动与非活动连接池及活动与非活动连接池组。还可以搜集有关在每秒内进行连接和断开连接数目的信息。</p>
<p class="MsoNormal" style="TEXT-INDENT: 21pt">在某些情况下，维护性能计数器会产生一些性能影响。为此，SQL Client .NET数据提供程序没有维护以下性能计数器：活动或自由连接的数目，或者每秒内放入池中的连接数目或断开连接的数目。可以通过向应用程序的配置文件中添加一项，以启用应用程序中的这些性能计数器。如需有关使用这些性能计数器的详细信息，请参阅MSDN网站上的文章&amp;ldquo;Using ADO.NET Performance Counters&amp;rdquo;(使用ADO.NET性能计数器)。</p>
<p class="MsoNormal" style="TEXT-INDENT: 21pt">为便于您提出有关连接池的问题，也便于我回答这些问题，我已经开发了一个示例应用程序，如图3.5所示，它可以作为本书示例代码中的一部分进行下载。这一应用程序允许使用如图3.3所示的SqlConnectionStringBuilder/PropertyGrid对话框生成连接字符串。可以很容易地生成新的SqlConnection，打开和关闭现有连接，以及调用ClearPool和ClearAllPools方法。此示例还可以通过【性能监视器】访问SQL Client性能计数器，而不需要以手动方式添加性能计数器。此应用程序的配置文件中包含一项，其能够启用在默认情况下被关闭的性能计数器。在每次创建、打开或关闭SqlConnection或关闭一个或所有连接池时，此示例中的性能计数器都会被更新。</p>
<p align="center"><img height="277" alt="" src="http://book.csdn.net/BookFiles/396/img/image031.jpg" width="284" /></p>
<p align="center">图3.5&amp;nbsp; 研究连接池</p>
<h3>8&amp;nbsp; ADO.NET如何确定是否使用放入池中的连接</h3>
<p class="MsoNormal" style="TEXT-INDENT: 21pt">简单地说，假定连接池未被禁用，则SQL Client .NET数据提供程序在您调用SqlConnection对象的Open方法时检查ConnectionString，并确定池中是否存在可用连接。如果存在可用连接，则SQL Client使用该连接。否则，打开一个到数据库的新连接。</p>
<p class="MsoNormal" style="TEXT-INDENT: 21pt">实际上还有一些需要说明的内容。设想一个ASP.NET应用程序，其中有多位用户以模拟(impersonation)登录同一数据库，每位用户都使用自己的凭据访问SQL Server数据库。每位用户的连接字符串都是相同的，但他们的凭据有很大不同。由于SQL Client考虑了用户权限，所以用于确定池中有哪些连接可供使用的逻辑要稍微复杂一些。</p>
<h3>9&amp;nbsp; 强制ADO.NET使用新</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='http://2.gravatar.com/avatar/b9f7391bdaee9d0a30a3fda8ddd6436e?s=49&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/b9f7391bdaee9d0a30a3fda8ddd6436e?s=98&amp;d=mm&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">作者 </span> <a class="url fn n" href="/blog/author/lee">Lee</a></span></span><span class="posted-on"><span class="screen-reader-text">发布于 </span><a href="/blog/2008/126.html" rel="bookmark"><time class="entry-date published" datetime="2008-06-23T09:35:43+00:00">2008年6月23日</time><time class="updated" datetime="2008-06-23T09:44:00+00:00">2008年6月23日</time></a></span><span class="cat-links"><span class="screen-reader-text">分类 </span><a href="/blog/category/dotnet" rel="category tag">.Net</a></span><span class="comments-link"><a href="/blog/2008/126.html#respond"><span class="screen-reader-text">于ADO.NET 2.0技术内幕 之 连接池</span>留下评论</a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-125" class="post-125 post type-post status-publish format-standard hentry category-dotnet">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="/blog/2008/125.html" rel="bookmark">GridView 72般绝技</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p><strong><font size="2">GridView无代码分页排序<br />GridView选中，编辑，取消，删除<br />GridView正反双向排序<br />GridView和下拉菜单Dro&#112;DownList结合<br />GridView和CheckBox结合<br />鼠标移到GridView某一行时改变该行的背景色方法一<br />鼠标移到GridView某一行时改变该行的背景色方法二<br />GridView实现删除时弹出确认对话框<br />GridView实现自动编号<br />GridView实现自定义时间货币等字符串格式<br /></font></strong><strong><font size="2">GridView实现用&amp;ldquo;&#8230;&amp;rdquo;代替超长字符串<br />GridView一般换行与强制换行<br />GridView显示隐藏某一列<br />GridView弹出新页面/弹出新窗口<br />GridView固定表头(不用javascript只用CSS，2行代码，很好用)<br />GridView合并表头多重表头无错完美版（以合并3列3行举例）<br />GridView突出显示某一单元格（例如金额低于多少，分数不及格等）<br />GridView加入自动求和求平均值小计<br />GridView数据导入Excel/Excel数据读入GridView</p>
<p></font></strong></p>
<p align="left"><strong>1.GridView无代码分页排序</strong>：</p>
<p align="left">效果图：<br /><img alt="" src="http://p.blog.csdn.net/images/p_blog_csdn_net/21aspnet/286353/o_gv5.gif" /><br />1.AllowSorting设为True，aspx代码中是AllowSorting=&amp;quot;True&amp;quot;；<br />2.默认1页10条，如果要修改每页条数，修改PageSize即可，在aspx代码中是PageSize=&amp;quot;12&amp;quot;。<br />3.默认的是单向排序的，右击GridView弹出&amp;ldquo;属性&amp;rdquo;，选择AllowSorting为True即可。</p>
<p></p>
<p align="left"><strong>2.GridView选中，编辑，取消，删除：</strong></p>
<p align="left">效果图：<br /><img alt="" src="http://p.blog.csdn.net/images/p_blog_csdn_net/21aspnet/286353/o_gv6.gif" /></p>
<p align="left"><strong>后台代码：<br /></strong>你可以使用sqlhelper,本文没用。代码如下：<br />using System;<br />using System.Data;<br />using System.Configuration;<br />using System.Web;<br />using System.Web.Security;<br />using System.Web.UI;<br />using System.Web.UI.WebControls;<br />using System.Web.UI.WebControls.WebParts;<br />using System.Web.UI.HtmlControls;<br />using System.Data.SqlClient;</p>
<p align="left">public partial class _Default : System.Web.UI.Page <br />{</p>
<p align="left">//清清月儿<a href="http://blog.csdn.net/21aspnet" target="_new"><font color="#000000">http://blog.csdn.net/21aspnet</font></a>&amp;nbsp;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; SqlConnection sqlcon;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; SqlCommand sqlcom;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; string strCon = &amp;quot;Data Source=(local);Database=数据库名;Uid=帐号;Pwd=密码&amp;quot;;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; protected void Page_Load(object sender, EventArgs e)<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; {<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if (!IsPostBack)<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; {<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; bind();<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; }<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; protected void GridView1_RowEditing(object sender, GridViewEditEventArgs e)<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; {<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; GridView1.EditIndex = e.NewEditIndex;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; bind();<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; }</p>
<p align="left">//删除<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; protected void GridView1_RowDeleting(object sender, GridViewDel&#101;teEventArgs e)<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; {<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; string sqlstr = &amp;quot;del&#101;te from&amp;nbsp;表 wh&#101;re id=&#39;&amp;quot; + GridView1.DataKeys[e.RowIndex].Value.ToString() + &amp;quot;&#39;&amp;quot;;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; sqlcon = new SqlConnection(strCon);<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; sqlcom = new SqlCommand(sqlstr,sqlcon);<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; sqlcon.Open();<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; sqlcom.ExecuteNonQuery();<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; sqlcon.Close();<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; bind();<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; }</p>
<p align="left">//更新<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; protected void GridView1_RowUpdating(object sender, GridViewUp&#100;ateEventArgs e)<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; {<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; sqlcon = new SqlConnection(strCon);<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; string sqlstr = &amp;quot;up&#100;ate 表 set 字段1=&#39;&amp;quot;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; + ((TextBox)(GridView1.Rows[e.RowIndex].Cells[1].Controls[0])).Text.ToString().Trim() + &amp;quot;&#39;,字段2=&#39;&amp;quot;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; + ((TextBox)(GridView1.Rows[e.RowIndex].Cells[2].Controls[0])).Text.ToString().Trim() + &amp;quot;&#39;,字段3=&#39;&amp;quot;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; + ((TextBox)(GridView1.Rows[e.RowIndex].Cells[3].Controls[0])).Text.ToString().Trim() + &amp;quot;&#39; wh&#101;re id=&#39;&amp;quot; <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; + GridView1.DataKeys[e.RowIndex].Value.ToString() + &amp;quot;&#39;&amp;quot;;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; sqlcom=new SqlCommand(sqlstr,sqlcon);<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; sqlcon.Open();<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; sqlcom.ExecuteNonQuery();<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; sqlcon.Close();<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; GridView1.EditIndex = -1;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; bind();<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; }</p>
<p align="left">//取消<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; protected void GridView1_RowCancelingEdit(object sender, GridViewCancelEditEventArgs e)<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; {<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; GridView1.EditIndex = -1;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; bind();<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; }</p>
<p align="left">//绑定<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; public void bind()<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; {<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; string sqlstr = &amp;quot;sel&#101;ct * from 表&amp;quot;;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; sqlcon = new SqlConnection(strCon);<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; SqlDataAdapter myda = new SqlDataAdapter(sqlstr, sqlcon);<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; DataSet myds = new DataSet();<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; sqlcon.Open();<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; myda.Fill(myds, &amp;quot;表<font size="2">&amp;quot;);</font><br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; GridView1.DataSource = myds;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; GridView1.DataKeyNames = new string[] { &amp;quot;id&amp;quot; };//主键<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; GridView1.DataBind();<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; sqlcon.Close();<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; }<br />}</p>
<p><strong>前台主要代码：<br /></strong>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &#8230; &#8230;<br />&amp;lt;asp:GridView ID=&amp;quot;GridView1&amp;quot; runat=&amp;quot;server&amp;quot; AutoGenerateColumns=&amp;quot;False&amp;quot; CellPadding=&amp;quot;4&amp;quot;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ForeColor=&amp;quot;#333333&amp;quot; GridLines=&amp;quot;None&amp;quot; OnRowDeleting=&amp;quot;GridView1_RowDeleting&amp;quot; OnRowEditing=&amp;quot;GridView1_RowEditing&amp;quot;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; OnRowUpdating=&amp;quot;GridView1_RowUpdating&amp;quot; OnRowCancelingEdit=&amp;quot;GridView1_RowCancelingEdit&amp;quot;&amp;gt;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;FooterStyle BackColor=&amp;quot;#990000&amp;quot; Font-Bold=&amp;quot;True&amp;quot; ForeColor=&amp;quot;White&amp;quot; /&amp;gt;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;Columns&amp;gt;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:BoundField DataField=&amp;quot;身份证号码&amp;quot; HeaderText=&amp;quot;用户ID&amp;quot; ReadOnly=&amp;quot;True&amp;quot; /&amp;gt;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:BoundField DataField=&amp;quot;姓名&amp;quot; HeaderText=&amp;quot;用户姓名&amp;quot; /&amp;gt;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:BoundField DataField=&amp;quot;员工性别&amp;quot; HeaderText=&amp;quot;性别&amp;quot; /&amp;gt;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:BoundField DataField=&amp;quot;家庭住址&amp;quot; HeaderText=&amp;quot;家庭住址&amp;quot; /&amp;gt;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:CommandField HeaderText=&amp;quot;选择&amp;quot; ShowSel&#101;ctButton=&amp;quot;True&amp;quot; /&amp;gt;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:CommandField HeaderText=&amp;quot;编辑&amp;quot; ShowEditButton=&amp;quot;True&amp;quot; /&amp;gt;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;asp:CommandField HeaderText=&amp;quot;删除&amp;quot; ShowDel&#101;teButton=&amp;quot;True&amp;quot; /&amp;gt;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/Columns&amp;gt;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;RowStyle ForeColor=&amp;quot;#000066&amp;quot; /&amp;gt;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;Sel&#101;ctedRowStyle BackColor=&amp;quot;#669999&amp;quot; Font-Bold=&amp;quot;True&amp;quot; ForeColor=&amp;quot;White&amp;quot; /&amp;gt;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;PagerStyle BackColor=&amp;quot;White&amp;quot; ForeColor=&amp;quot;#000066&amp;quot; HorizontalAlign=&amp;quot;Left&amp;quot; /&amp;gt;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;HeaderStyle BackColor=&amp;quot;#006699&amp;quot; Font-Bold=&amp;quot;True&amp;quot; ForeColor=&amp;quot;White&amp;quot; /&amp;gt;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/asp:GridView&amp;gt;</p>
<p align="left"><strong>3.GridView正反双向排序：<br /></strong>效果图：点姓名各2次的排序，点其他也一样可以。<br /><img alt="" src="http://p.blog.csdn.net/images/p_blog_csdn_net/21aspnet/286353/o_gv7.gif" /><img alt="" src="http://p.blog.csdn.net/images/p_blog_csdn_net/21aspnet/286353/o_gv8.gif" /><br /><strong>后台代码：</strong><br />using System;<br />using System.Data;<br />using System.Configuration;<br />using System.Collections;<br />using System.Web;<br />using System.Web.Security;<br />using System.Web.UI;<br />using System.Web.UI.WebControls;<br />using System.Web.UI.WebControls.WebParts;<br />using System.Web.UI.HtmlControls;<br />using System.Data.SqlClient;<br />public partial class Default3 : System.Web.UI.Page<br />{</p>
<p align="left">//清清月儿的博客<a href="http://blog.csdn.net/21aspnet" target="_new"><font color="#000000">http://blog.csdn.net/21as</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='http://2.gravatar.com/avatar/b9f7391bdaee9d0a30a3fda8ddd6436e?s=49&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/b9f7391bdaee9d0a30a3fda8ddd6436e?s=98&amp;d=mm&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">作者 </span> <a class="url fn n" href="/blog/author/lee">Lee</a></span></span><span class="posted-on"><span class="screen-reader-text">发布于 </span><a href="/blog/2008/125.html" rel="bookmark"><time class="entry-date published" datetime="2008-06-20T13:30:56+00:00">2008年6月20日</time><time class="updated" datetime="2008-06-23T09:54:00+00:00">2008年6月23日</time></a></span><span class="cat-links"><span class="screen-reader-text">分类 </span><a href="/blog/category/dotnet" rel="category tag">.Net</a></span><span class="comments-link"><a href="/blog/2008/125.html#respond"><span class="screen-reader-text">于GridView 72般绝技</span>留下评论</a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-124" class="post-124 post type-post status-publish format-standard hentry category-dotnet">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="/blog/2008/124.html" rel="bookmark">Asp.Net Web 部署项目</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<div>
<div class="MTPS_CollapsibleRegion" id="ctl00_ContentPlaceHolder1_cpe55532">
<div class="CollapseRegionLink" id="ctl00_ContentPlaceHolder1_cpe55532_h"><img id="ctl00_ContentPlaceHolder1_cpe55532_i" style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; VERTICAL-ALIGN: middle; BORDER-RIGHT-WIDTH: 0px" alt="" src="http://i.msdn.microsoft.com/platform/Controls/CollapsibleArea/resources/minus.gif" />&amp;nbsp;目录 </div>
<div class="MTPS_CollapsibleSection" id="ctl00_ContentPlaceHolder1_cpe55532_c" style="DISPLAY: block; OVERFLOW: hidden; WIDTH: auto; HEIGHT: auto" olddisplay="null">
<div class="MTPS_CollapsibleSection" id="" style="BORDER-RIGHT: medium none; BORDER-TOP: medium none; DISPLAY: block; BORDER-LEFT: medium none; BORDER-BOTTOM: medium none"><a href="#S1">在 ASP.NET 2.0 中部署</a> <br /><a href="#S2">Web 部署项目</a> <br /><a href="#S3">合并程序集</a> <br /><a href="#S4">可插入配置文件</a> <br /><a href="#S5">创建可重用用户控件</a> <br /><a href="#S6">总结</a> </div>
</div>
</div>
<p></div>
<div class="ArticleNormalPara">当 ASP 第一次发布时，Web 编程还比较困难，因为需要 IIS 来处理 ASP 页。后来，ASP.NET 2.0 和 Visual Studio<span class="superscript"><font size="1">&amp;reg;</font></span> 2005 通过引入网站开发模型使一切工作都变得容易了。借助该网站模型，您不必在 Visual Studio 中创建新项目，而是可以指向一个目录并开始编写网页和代码。此外，您还可以使用内置的 ASP.NET Development Server 快速测试站点，ASP.NET Development Server 将 ASP.NET 寄宿在一个本地进程中，并消除了必须安装 IIS 才能进行开发这一先决条件。该网站模型的魅力在于您在开发 Web 应用程序时无需考虑打包和部署。需要其他类时怎么办？向 App_Code 目录添加一个 .cs 文件即可开始编写。希望将可本地化的字符串存储在资源文件中时怎么办？向 App_GlobalResources 目录添加一个 .resx 文件并键入字符串。一切都顺顺当当；您根本就不必考虑编译和部署方面的事情。</div>
<div class="ArticleNormalPara">在准备进行部署时，您有多种可选方案。最简单的方案是将文件复制到主运行服务器并按要求编译每一个文件（和在测试环境中一样）。第二种方案是使用 aspnet_compiler.exe 实用工具将应用程序预编译为二进制版本，之后将只剩下要放到服务器上的一组程序集、静态内容和配置文件。第三种方案也使用 aspnet_compiler.exe，但要创建一个可更新的二进制部署，其中 .as*x 文件保持不变（并且可修改），而所有代码文件都编译为二进制程序集。</div>
<div class="ArticleNormalPara">这似乎涵盖了每一种可能的情况，开发人员可以一心一意地编写 Web 应用程序，而在以后实际部署时再作打包和部署决定。不过，此模型也遭到了相当大的反对，特别是那些习惯了自己开发的 Web 项目是在实际项目文件中指定的实际项目的开发人员的反对，这些项目允许注入生成前和生成后函数、从生成过程排除文件以及使用命令行开关在调试和发布版本之间进行切换等操作。有鉴于此，Microsoft 迅速推出了 Web 应用程序项目（即 WAP），最初它是作为 Visual Studio 2005 的插件发布的，现在包含在 Visual Studio 2005 Service Pack 1 (SP1) 中，Visual Studio 2005 Service Pack 1 (SP1) 可从 <a href="http://msdn.microsoft.com/vstudio/support/vs2005sp1"><font color="#0033cc">msdn.microsoft.com/vstudio/support/vs2005sp1</font></a> 下载。</div>
<div class="ArticleNormalPara">WAP 可替代与 Visual Studio .NET 2003 Web 项目模型非常接近的网站模型。新的 WAP 模型会在生成过程中编译所有源代码文件，并在本地的 /bin 目录中生成一个用于部署的程序集。WAP 还使得增量采用 ASP.NET 2.0 引入的新的分部类代码隐藏模型变得更加容易，因为现在您可以打开 Visual Studio .NET 2003 项目，并且在转换过程中只修改 .sln 和 .csproj（或 .vbproj）文件。然后可将每个文件及其代码隐藏类转换为与项目中任何其他文件都无关的新的分部类模型（操作方法是：在解决方案资源管理器中右键单击各个文件并选择&amp;ldquo;转换为 Web 应用程序&amp;rdquo;），也可以让它们仍然使用旧模型。这与将 Visual Studio .NET 2003 Web 项目转换为网站模型大不相同，转换为网站模型会同时转换所有文件，并且不支持增量采用。</div>
<div class="ArticleNormalPara">最后，还有一个称为&amp;ldquo;Web 部署项目&amp;rdquo;（本专栏的主题）的新项目类型，它引入了许多既针对网站项目又针对 Web 应用程序项目的附加部署选项。 Web 部署项目弥补了既针对网站应用程序又针对 Web 应用程序项目的部署选项中的遗留漏洞，并且可以简单而又可扩展地实现几乎任何部署方案。 为确切了解这一新项目类型增加了哪些内容，我们先来回顾一下在 Web 部署项目推出之前的情况。</div>
<p></p>
<div class="ArticleTypeTitle" id="S1">在 ASP.NET 2.0 中部署</div>
<div class="ArticleNormalPara">使用网站模型生成应用程序时，您可以选择对部署站点进行预编译。通过 Visual Studio 2005 中的&amp;ldquo;生成&amp;rdquo;|&amp;ldquo;发布&amp;rdquo;菜单或直接通过命令行实用工具 aspnet_compiler.exe，您可以访问预编译实用工具。<strong>图 1</strong> 显示了 Visual Studio 所显示的此工具的界面。</div>
<div class="ArticleImageSpacer"><img onmouseover="this.style.cursor=&#39;pointer&#39;;" style="CURSOR: pointer" onclick="var large=&#39;cc163448.fig01_L.gif&#39;; var small=&#39;cc163448.fig01.gif&#39;; var current=this.src;  if (current.indexOf(large) &amp;gt; 0) this.src=small; if (current.indexOf(small) &amp;gt; 0)this.src=large;" alt="" src="http://msdn.microsoft.com/zh-cn/magazine/cc163448.fig01.gif" /></p>
<div class="ArticleImageCaptionText">图 1<strong>&amp;nbsp;网站发布实用工具&amp;nbsp;</strong>(单击该图像获得较大视图)</div>
</div>
<div class="ArticleNormalPara">使用发布实用工具时必须作出的第一个决定是 .as*x 文件在部署后是否可更新（在 aspnet_compiler.exe 命令行实用工具中使用 -u 开关的&amp;ldquo;允许更新此预编译站点&amp;rdquo;选项）。 此决定取决于在部署后是否希望能够在不重复整个部署过程的情况下对网页进行较少更改。事实上，您可能希望明确禁止对已部署网页进行任何修改，并要求所有修改都要遵循标准的部署（也希望遵循标准的测试）过程，在这种情况下，应选择将站点发布为不可更新。</div>
<div class="ArticleNormalPara">将站点发布为不可更新时，您可以完全删除所有 .as*x 文件，而只发布二进制程序集（以及配置文件和静态内容）。不过，如果没有物理文件，ASP.NET 将无法确定哪些类要用于哪些端点请求。例如，如果您的应用程序收到一个请求 Page1.aspx 的请求，而您已经使用了不可更新的二进制部署，则磁盘上很可能没有任何 Page1.aspx 文件，并且现有配置文件中没有任何内容来指示部署到 /bin 目录的程序集集合中哪个类应是该请求的实际处理程序。为弥补这一缺陷，编译过程还将生成一个 .compiled 文件集合，这些文件以简单的 XML 格式包含端点-类型映射和文件依赖关系信息，同时这些文件必须与所部署站点的 /bin 目录中的二进制程序集一起发布。例如，如果应用程序中原来有一个名为 Page1.aspx 的页，则 aspnet_compiler.exe 实用工具会生成一个名为 page1.aspx.cdcab7d2.compiled（哈希代码不定）的文件，其中包含以下 XML：</p>
<div class="" id="ctl00_ContentPlaceHolder1_ctl04_">
<div class="CodeSnippetTitleBar">
<div class="CodeDisplayLanguage">&amp;nbsp;</div>
<div class="CopyCodeButton">&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;utf-8&amp;quot;?&amp;gt;<br />&amp;lt;preserve resultType=&amp;quot;3&amp;quot;<br />virtualPath=&amp;quot;/SampleWebSite/Page1.aspx&amp;quot;<br />hash=&amp;quot;8a8da6c5a&amp;quot; filehash=&amp;quot;42c4a74221152888&amp;quot;<br />flags=&amp;quot;110000&amp;quot; assembly=&amp;quot;App_Web_aq9bt8mj&amp;quot;<br />type=&amp;quot;ASP.page1_aspx&amp;quot;&amp;gt;<br />&amp;lt;filedeps&amp;gt;<br />&amp;lt;filedep name=&amp;quot;/SampleWebSite/Page1.aspx&amp;quot; /&amp;gt;<br />&amp;lt;filedep name=&amp;quot;/SampleWebSite/Page1.aspx.cs&amp;quot; /&amp;gt;<br />&amp;lt;/filedeps&amp;gt;<br />&amp;lt;/preserve&amp;gt;</div>
</div>
</div>
</div>
<div class="ArticleNormalPara">使用此实用工具发布网站时必须作出的另一个重要决定是确定生成的程序集的打包粒度。通过选中&amp;ldquo;使用固定命名和单页程序集&amp;rdquo;（或在 aspnet_compiler.exe 命令行实用工具中使用 -fixednames），既可为站点中的每个目录创建单独的程序集，又可为站点中的每个可编译文件创建单独的程序集。作出该决定并不像您可能想像的那么容易，因为每个选项都有其潜在问题。如果决定不使用 -fixednames 选项，则每次发布应用程序时都会生成一组全新的程序集，并且它们的名称与之前发布的程序集不同。这意味着部署更加复杂，因为在部署新的程序集之前必须删除主运行服务器上所有以前发布的程序集，否则在处理下一个请求时将生成冗余的类定义错误。使用 -fixednames 选项可以解决此问题，因为每个文件都将与命名清晰的程序集对应，而这些程序集在一次编译和下次编译中不会发生变化。不过，如果站点规模较大，则为每个网页、控件和母版页分别生成单独的程序集，很明显意味着您要管理成百上千个程序集的发布。Web 部署项目非常圆满地解决了部署中程序集粒度这一问题，如下所示。</div>
<div class="ArticleNormalPara">您还可以将程序集签名引入编译过程，以便创建具有强名称的不同版本的程序集，如果需要这也适用于全局程序集缓存 (GAC) 中的部署。通过使用 -aptca 选项，您可以使用程序集级别的属性 AllowPartiallyTrustedCallers 来标记生成的程序集，在将任何程序集部署到 GAC 并且以低等或中等信任级别运行 ASP.NET 的情况下，这是必要的。（请注意，此属性应仅应用于已证明不会暴露任何安全漏洞的程序集，因为如有漏洞，使用此属性可能招致引诱攻击。）</div>
<div class="ArticleNormalPara">有关发布站点的另一个细节是如果决定使用 Web 应用程序项目而不使用网站模型，则&amp;ldquo;生成&amp;rdquo;|&amp;ldquo;发布&amp;rdquo;对话框的外观将大不相同，如<strong>图 2</strong> 所示。Web 应用程序项目假定您希望将应用程序发布为可更新的 .as*x 文件和预编译的源文件（开发中它所使用的同一模型），因此仅针对二进制的部署选项不可用。此实用工具实质上更接近于&amp;ldquo;复制网站&amp;rdquo;实用工具（随网站一起提供）而不是&amp;ldquo;发布网站&amp;rdquo;实用工具，因为它需要复制由标准生成过程生成的文件。</div>
<div class="ArticleImageSpacer"><img onmouseover="this.style.cursor=&#39;pointer&#39;;" style="CURSOR: pointer" onclick="var large=&#39;cc163448.fig02_L.gif&#39;; var small=&#39;cc163448.fig02.gif&#39;; var current=this.src;  if (current.indexOf(large) &amp;gt; 0) this.src=small; if (current.indexOf(small) &amp;gt; 0)this.src=large;" alt="" src="http://msdn.microsoft.com/zh-cn/magazine/cc163448.fig02.gif" /></p>
<div class="ArticleImageCaptionText">图 2<strong>&amp;nbsp;Web 应用程序项目的发布 Web 实用工具&amp;nbsp;</strong>(单击该图像获得较大视图)</div>
</div>
<div class="ArticleNormalPara">从技术上讲，即使您使用 Web 应用程序项目，也不会限制您使用仅针对二进制（不可更新）的部署。其实，WAP 生成的输出是一个有效的网站，然后您可以传递 aspnet_compiler.exe 实用工具来生成创建二进制部署。幸运的是，您只是不能从 Web 部署项目调整过的 Visual Studio 2005 界面调用它而已。</div>
<p></p>
<div class="ArticleTypeTitle" id="S2">Web 部署项目</div>
<div class="ArticleNormalPara">那么迄今为止所有现有的编译和部署选项中缺少什么呢？主要缺少两种功能：控制程序集命名（特别是为了进行部署）的功能，以及将所有输出的程序集合并为一个程序集从而简化部署的功能。Web 部署项目可以解决这两个问题。但或许更重要的是，它们还与网站应用程序和 Web 应用程序项目的部署问题中的许多遗留问题有关。</div>
<div class="ArticleNormalPara">它们的核心是，Web 部署项目（可从 <a href="http://msdn2.microsoft.com/aa336619.aspx"><font color="#0033cc">msdn2.microsoft.com/aa336619.aspx</font></a> 下载）代表的只是向您解决方案中添加的另一个项目类型。与所有 Visual Studio 项目文件一样，Web 部署项目也是可在 IDE 中直接编译或从命令行运行的 MSBuild 脚本。不过，Web 部署项目包含用于编译和打包网站（或 Web 应用程序项目）的生成命令，而不指定要编译的源代码文件集合。这意味着它们会调用 aspnet_compiler.exe 实用工具（以及其他实用工具）来创建特定 Web 应用程序的部署。Web 部署项目是作为 Visual Studio 插件包提供的，其中包含了一个用于注入新项目的易用菜单项和一个用于控制所有可用设置的完整属性页集。若要向现有应用程序中添加新项目，可右键单击现有网站（或 Web 应用程序项目），然后选择&amp;ldquo;添加 Web 部署项目&amp;rdquo;项，如<strong>图 3</strong> 所示。此操作将把一个包含 MSBuild 脚本的新 .wdproj 文件添加到您的解决方案中，并会生成您所创建的应用程序的部署。</div>
<div class="ArticleImageSpacer"><img alt="" src="http://msdn.microsoft.com/zh-cn/magazine/cc163448.fig03.gif" /></p>
<div class="ArticleImageCaptionText">图 3<strong>&amp;nbsp;添加 Web 部署项目&amp;nbsp;</strong></div>
</div>
<div class="ArticleImageSpacer"><img alt="" src="http://msdn.microsoft.com/zh-cn/magazine/cc163448.fig03a.gif" /></p>
<div class="ArticleImageCaptionText">图 3a<strong>&amp;nbsp; &amp;nbsp;</strong></div>
</div>
<div class="ArticleImageSpacer"><img onmouseover="this.style.cursor=&#39;pointer&#39;;" style="CURSOR: pointer" onclick="var large=&#39;cc163448.fig03b_L.gif&#39;; var small=&#39;cc163448.fig03b.gif&#39;; var current=this.src;  if (current.indexOf(large) &amp;gt; 0) this.src=small; if (current.indexOf(small) &amp;gt; 0)this.src=large;" alt="" src="http://msdn.microsoft.com/zh-cn/magazine/cc163448.fig03b.gif" /></p>
<div class="ArticleImageCaptionText">图 3b<strong>&amp;nbsp; &amp;nbsp;</strong>(单击该图像获得较大视图)</div>
</div>
<div class="ArticleImageSpacer"><img alt="" src="http://msdn.microsoft.com/zh-cn/magazine/cc163448.fig03c.gif" /></p>
<div class="ArticleImageCaptionText">图 3c<strong>&amp;nbsp; &amp;nbsp;</strong></div>
</div>
<div class="ArticleNormalPara">将 Web 部署项目添加到您的解决方案之后，您就可以通过访问</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='http://2.gravatar.com/avatar/b9f7391bdaee9d0a30a3fda8ddd6436e?s=49&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/b9f7391bdaee9d0a30a3fda8ddd6436e?s=98&amp;d=mm&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">作者 </span> <a class="url fn n" href="/blog/author/lee">Lee</a></span></span><span class="posted-on"><span class="screen-reader-text">发布于 </span><a href="/blog/2008/124.html" rel="bookmark"><time class="entry-date published" datetime="2008-06-20T10:36:31+00:00">2008年6月20日</time><time class="updated" datetime="2008-06-23T09:46:00+00:00">2008年6月23日</time></a></span><span class="cat-links"><span class="screen-reader-text">分类 </span><a href="/blog/category/dotnet" rel="category tag">.Net</a></span><span class="comments-link"><a href="/blog/2008/124.html#comments"><span class="screen-reader-text">Asp.Net Web 部署项目</span>有1条评论</a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-123" class="post-123 post type-post status-publish format-standard hentry category-web_development">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="/blog/2008/123.html" rel="bookmark">域名带来的流量</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>　　去年cn域名推广时，我也凑热闹注册了几个域名。由于一时偷懒，懒到现在，除了本站的[url=http://www.biglee.cn/]biglee.cn[/url]和[url=http://lee.zj.cn/]lee.zj.cn[/url]外，好多域名都没真正用起来。<br />
　　昨天为了用cn域名测试Google的企业邮局套件，去给之前注册的[url=http://qqkav.com.cn]qqkav.com.cn[/url]做MX解析，顺便也做了URL转发到本站。刚才查看本站流量时发现此域名今天已经带来了7个IP的流量，其中一个是百度搜索[url=http://www.qqkav.com.cn]www.qqkav.com.cn[/url]来的，其它的都是手工输入的。<br />
　　看来此域名还是不错的，可以好好利用一下，不能浪费了。<br />
　　先想想有什么好项目做没。也欢迎各位朋友提建议。</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='http://2.gravatar.com/avatar/b9f7391bdaee9d0a30a3fda8ddd6436e?s=49&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/b9f7391bdaee9d0a30a3fda8ddd6436e?s=98&amp;d=mm&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">作者 </span> <a class="url fn n" href="/blog/author/lee">Lee</a></span></span><span class="posted-on"><span class="screen-reader-text">发布于 </span><a href="/blog/2008/123.html" rel="bookmark"><time class="entry-date published" datetime="2008-06-19T14:47:02+00:00">2008年6月19日</time><time class="updated" datetime="2008-07-31T05:00:00+00:00">2008年7月31日</time></a></span><span class="cat-links"><span class="screen-reader-text">分类 </span><a href="/blog/category/web_development" rel="category tag">网站技术</a></span><span class="comments-link"><a href="/blog/2008/123.html#respond"><span class="screen-reader-text">于域名带来的流量</span>留下评论</a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-122" class="post-122 post type-post status-publish format-standard hentry category-digest">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="/blog/2008/122.html" rel="bookmark">为人处世的经验？仅供参考！</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>1. 人之所以痛苦，在于追求错误的东西。<br />
2. 如果你不给自己烦恼，别人也永远不可能给你烦恼。因为你自己的内心，你放不下。<br />
3. 你永远要感谢给你逆境的众生。<br />
4. 你永远要宽恕众生，不论他有多坏，甚至他伤害过你，你一定要放下，才能得到真正的快乐。<br />
5. 当你快乐时，你要想这快乐不是永恒的。当你痛苦时，你要想这痛苦也不是永恒的。<br />
6. 今日的执著，会造成明日的后悔。<br />
7. 你可以拥有爱，但不要执著，因为分离是必然的。<br />
8. 不要浪费你的生命在你一定会后悔的地方上。<br />
9. 你什么时候放下，什么时候就没有烦恼。<br />
10. 每一种创伤，都是一种成熟。<br />
11. 狂妄的人有救，自卑的人没有救，认识自己，降伏自己，改变自己，才能改变别人。<br />
12. 你不要一直不满人家，你应该一直检讨自己才对。不满人家，是苦了你自己。<br />
13. 一个人如果不能从内心去原谅别人，那他就永远不会心安理得。<br />
14. 心中装满着自己的看法与想法的人，永远听不见别人的心声。<br />
15. 毁灭人只要一句话，培植一个人却要千句话，请你多口下留情。<br />
16. 根本不必回头去看咒骂你的人是谁？如果有一条疯狗咬你一口，难道你也要趴下去反咬他一口吗？<br />
17. 永远不要浪费你的一分一秒，去想任何你不喜欢的人。<br />
18. 请你用慈悲心和温和的态度，把你的不满与委屈说出来，别人就容易接受。<br />
19. 同样的瓶子，你为什么要装毒药呢？同样的心里，你为什么要充满着烦恼呢？<br />
20. 得不到的东西，我们会一直以为他是美好的，那是因为你对他了解太少，没有时间与他相处在一起。当有一天，你深入了解后，你会发现原不是你想像中的那么美好。<br />
21. 活着一天，就是有福气，就该珍惜。当我哭泣我没有鞋子穿的时候，我发现有人却没有脚。<br />
22. 多一分心力去注意别人，就少一分心力反省自己，你懂吗？<br />
23. 憎恨别人对自己是一种很大的损失。<br />
24. 每一个人都拥有生命，但并非每个人都懂得生命，乃至于珍惜生命。不了解生命的人，生命对他来说，是一种惩罚。<br />
25. 情执是苦恼的原因，放下情执，你才能得到自在<br />
26. 不要太肯定自己的看法，这样子比较少后悔。<br />
27. 当你对自己诚实的时候，世界上没有人能够欺骗得了你。<br />
28. 用伤害别人的手段来掩饰自己缺点的人，是可耻的。<br />
29. 默默的关怀与祝福别人，那是一种无形的布施。<br />
30. 不要刻意去猜测他人的想法，如果你没有智慧与经验的正确判断，通常都会有错误的。<br />
31. 要了解一个人，只需要看他的出发点与目的地是否相同，就可以知道他是否真心的。<br />
32. 人生的真理，只是藏在平淡无味之中。<br />
33. 不洗澡的人，硬擦香水是不会香的。名声与尊贵，是来自于真才实学的。有德自然香。<br />
34. 时间总会过去的，让时间流走你的烦恼吧！<br />
35. 你硬要把单纯的事情看得很严重，那样子你会很痛苦。<br />
36. 永远扭曲别人善意的人，无药可救。<br />
37. 说一句谎话，要编造十句谎话来弥补，何苦呢？<br />
38. 白白的过一天，无所事事，就像犯了窃盗罪一样<br />
39. 广结众缘，就是不要去伤害任何一个人。<br />
40. 沉默是毁谤最好的答覆。<br />
41. 对人恭敬，就是在庄严你自己。<br />
42. 拥有一颗无私的爱心，便拥有了一切。<br />
43. 来是偶然的，走是必然的。所以你必须，随缘不变，不变随缘。<br />
44. 慈悲是你最好的武器。<br />
45. 只要面对现实，你才能超越现实。<br />
46. 良心是每一个人最公正的审判官，你骗得了别人，却永远骗不了你自己的良心。<br />
47. 不懂得自爱的人，是没有能力去爱别人的。<br />
48. 有时候我们要冷静问问自已，我们在追求什么？我们活着为了什么？<br />
49. 不要因为小小的争执，远离了你至亲的好友，也不要因为小小的怨恨，忘记了别人的大恩。<br />
50. 感谢上苍我所拥有的，感谢上苍我所没有的。<br />
51. 凡是能站在别人的角度为他人着想，这个就是慈悲。<br />
52. 说话不要有攻击性，不要有杀伤力，不夸已能，不扬人恶，自然能化敌为友。<br />
53. 诚实的面对你内心的矛盾和污点，不要欺骗你自己。<br />
54. 因果不曾亏欠过我们什么，所以请不要抱怨。<br />
55. 大多数的人一辈子只做了三件事；自欺、欺人、被人欺。<br />
56. 心是最大的骗子，别人能骗你一时，而它却会骗你一辈子<br />
57. 只要自觉心安，东西南北都好。如有一人未度，切莫自己逃了。<br />
58. 当你手中抓住一件东西不放时，你只能拥有这件东西，如果你肯放手，你就有机会选择别的。人的心若死执自己的观念，不肯放下，那么他的智慧也只能达到某种程度而已<br />
59. 如果你能够平平安安的渡过一天，那就是一种福气了。多少人在今天已经见不到明天的太阳，多少人在今天已经成了残废，多少人在今天已经失去了自由，多少人在今天已经家破人亡。<br />
60. 你有你的生命观，我有我的生命观，我不干涉你。只要我能，我就感化你。如果不能，那我就认命。<br />
61. 你希望掌握永恒，那你必须控制现在。<br />
62. 恶口永远不要出自于我们的口中，不管他有多坏，有多恶。你愈骂他，你的心就被污染了，你要想，他就是你的善知识。<br />
63. 别人可以违背因果，别人可以害我们，打我们，毁谤我们。可是我们不能因此而憎恨别人，为什么？我们一定要保有一颗完整的本性和一颗清净的心。<br />
64. 如果一个人没有苦难的感受，就不容易对他人给予同情。你要学救苦救难的精神，就得先受苦受难。<br />
65. 世界原本就不是属于你，因此你用不着抛弃，要抛弃的是一切的执著。万物皆为我所用，但非我所属。<br />
66. 虽然我们不能改变周遭的世界，我们就只好改变自己，用慈悲心和智慧心来面对这一切。</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='http://2.gravatar.com/avatar/b9f7391bdaee9d0a30a3fda8ddd6436e?s=49&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/b9f7391bdaee9d0a30a3fda8ddd6436e?s=98&amp;d=mm&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">作者 </span> <a class="url fn n" href="/blog/author/lee">Lee</a></span></span><span class="posted-on"><span class="screen-reader-text">发布于 </span><a href="/blog/2008/122.html" rel="bookmark"><time class="entry-date published" datetime="2008-06-18T13:38:16+00:00">2008年6月18日</time><time class="updated" datetime="-001-11-30T00:00:00+00:00">-0001年11月30日</time></a></span><span class="cat-links"><span class="screen-reader-text">分类 </span><a href="/blog/category/digest" rel="category tag">文摘</a></span><span class="comments-link"><a href="/blog/2008/122.html#respond"><span class="screen-reader-text">于为人处世的经验？仅供参考！</span>留下评论</a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-120" class="post-120 post type-post status-publish format-standard hentry category-orther">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="/blog/2008/120.html" rel="bookmark">不错的网络电话，可以免费试用</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>　　UUCall网络电话，电脑对电脑通话免费。拨打国内电话资费也很便宜。对于长途较多的人来说可以一试，能节省不少话费。<br />
　　现在正进行免费试用活动，最多可试用60分钟。[b][url=http://www.uucall.com/tj28692716.html]详细情况请点击此处了解。现在就去注册领用话费！[/url][/b]。</p>
<p>　　个人感觉通话质量不错。话费也便宜，平时坐电脑前，且电话比较多的朋友可以一试。而且，在线时间得到的积分可以换话费。网站上还有一些免费换话费的活动。</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='http://2.gravatar.com/avatar/b9f7391bdaee9d0a30a3fda8ddd6436e?s=49&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/b9f7391bdaee9d0a30a3fda8ddd6436e?s=98&amp;d=mm&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">作者 </span> <a class="url fn n" href="/blog/author/lee">Lee</a></span></span><span class="posted-on"><span class="screen-reader-text">发布于 </span><a href="/blog/2008/120.html" rel="bookmark"><time class="entry-date published" datetime="2008-04-26T19:05:48+00:00">2008年4月26日</time><time class="updated" datetime="2011-02-24T04:42:00+00:00">2011年2月24日</time></a></span><span class="cat-links"><span class="screen-reader-text">分类 </span><a href="/blog/category/orther" rel="category tag">杂货铺</a></span><span class="comments-link"><a href="/blog/2008/120.html#respond"><span class="screen-reader-text">于不错的网络电话，可以免费试用</span>留下评论</a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-119" class="post-119 post type-post status-publish format-standard hentry category-pc_technology">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="/blog/2008/119.html" rel="bookmark">程序安装错误解决方法实录</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>　　前几天办了个农行的网银，农行送了个K宝。<br />
　　兴冲冲地安装K宝想熟悉一下农行的网银，结果出了点意外。安装K宝驱动时由于Macfee规则太严，有些文件没有成功生成。关了麦咖啡的访问扫描，想重新安装驱动软件，结果安装软件提示说驱动软件已经被破坏，为了安全，请先删除再安装，头大的是反安装文件被该死的咖啡阻止了，没有生成。怎么办呢？<br />
　　没有解决不了的事！我先想到的是，可能是注册表里写入了相关信息，所以安装软件检测到了，要先删除才能安装。于是我开始清理注册表。先手工删除一些该软件的信息，试了下安装，不行！又用优化大师清理了下注册表，再运行安装程序，还是不行。真是可恶。<br />
　　正一筹莫展时，突然想到先再其它电脑上安装好这个软件，然后把反安装文件拷贝到我这电脑上，运行一下，应该就能搞定。说干就干。打开我的破神舟本本，安装好软件，再把反安装文件拷到这电脑上，运行一下，提示卸载成功。再运行安装程序。成功了！<br />
　　有时换个思路，多想想，在山穷水尽时，又会柳暗花明！</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='http://2.gravatar.com/avatar/b9f7391bdaee9d0a30a3fda8ddd6436e?s=49&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/b9f7391bdaee9d0a30a3fda8ddd6436e?s=98&amp;d=mm&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">作者 </span> <a class="url fn n" href="/blog/author/lee">Lee</a></span></span><span class="posted-on"><span class="screen-reader-text">发布于 </span><a href="/blog/2008/119.html" rel="bookmark"><time class="entry-date published" datetime="2008-04-05T22:54:46+00:00">2008年4月5日</time><time class="updated" datetime="2008-04-05T10:55:00+00:00">2008年4月5日</time></a></span><span class="cat-links"><span class="screen-reader-text">分类 </span><a href="/blog/category/pc_technology" rel="category tag">PC技术</a></span><span class="comments-link"><a href="/blog/2008/119.html#respond"><span class="screen-reader-text">于程序安装错误解决方法实录</span>留下评论</a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-121" class="post-121 post type-post status-publish format-standard hentry category-web_development">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="/blog/2008/121.html" rel="bookmark">26个日文片假名导致Access搜索(80040e14/内存溢出)的解决办法</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>26个日文片假名导致Access搜索(80040e14/内存溢出)的解决办法</p>
<p>补充最新修改版，使用Unicode的字符代码，而不是非unicode（负数值，有时会出错）代码<br />
ゴ ガ ギ グ ゲ ザ ジ ズ ヅ デ ド ポ ベ プ ビ パ ヴ ボ ペ ブ ピ バ ヂ ダ ゾ ゼ<br />
当字段内包含了这26个日文字符任意一个多个时,就会导致在执行SQL语句中包含了<br />
[字段] like &#39;%aaaaa%&#39; 或 inStr(1,[字段],&#39;aaaaa&#39;,1)>0<br />
这样的查询时,毫无道理的出现了<br />
&#8220;Microsoft JET Database Engine 错误 &#39;80040e14&#39; 内存溢出&#8221;的错误<br />
其他Jet SQL函数命令未作测试，大概与字符搜索定位匹配相关的都可能出错</p>
<p>搜索相关资料得知被微软工程师证实是Access的bug,可能是语法关系都是微软的东东<br />
在vbs中 执行inStr(1,日文平假名变量,&#8221;aaaaa&#8221;,1)依然要出现错误<br />
Microsoft VBScript 运行时错误 错误 &#39;800a0005&#39; 无效的过程调用或参数: &#39;instr&#39; </p>
<p>没有搜索,因这几个字符出现Access的论坛网站搜索无法进行,何等痛苦<br />
昨天一朋友大叫怪事,他的音乐数据库无法搜索了,只有30000条记录时是好的<br />
毫无疑问,日文片假名是祸根,花几分钟把有包含上面的日文替换成&#8221;?&#8221;搜索顺利恢复<br />
找来论坛程序用户群最大的动网dvBBS AC版本 7.0SP2 版测试,同样有这个日文发帖后 导致无法搜索并且运行时出错的问题<br />
线上去搜索 &#39;80040e14&#39; 内存溢出&#8221; 的错误 多的是!</p>
<p>一简单有效的解决办法:<br />
对这26个字符进行编码和解码,可能效率感觉不理想,测试下来问题不大,速度影响不是太大</p>
<p>编码:</p>
<p>Function Jencode(byVal iStr)<br />
if isnull(iStr) o&#114; isEmpty(iStr) then<br />
  Jencode=&#8221;&#8221;<br />
  Exit function<br />
end if<br />
dim F,i,E</p>
<p>  E=array(&#8220;Jn0;&#8221;,&#8221;Jn1;&#8221;,&#8221;Jn2;&#8221;,&#8221;Jn3;&#8221;,&#8221;Jn4;&#8221;,&#8221;Jn5;&#8221;,&#8221;Jn6;&#8221;,&#8221;Jn7;&#8221;,&#8221;Jn8;&#8221;,</p>
<p>&#8220;Jn9;&#8221;,&#8221;Jn10;&#8221;,&#8221;Jn11;&#8221;,&#8221;Jn12;&#8221;,&#8221;Jn13;&#8221;,&#8221;Jn14;&#8221;,&#8221;Jn15;&#8221;,&#8221;Jn16;&#8221;,&#8221;Jn17;&#8221;,</p>
<p>&#8220;Jn18;&#8221;,&#8221;Jn19;&#8221;,&#8221;Jn20;&#8221;,&#8221;Jn21;&#8221;,&#8221;Jn22;&#8221;,&#8221;Jn23;&#8221;,&#8221;Jn24;&#8221;,&#8221;Jn25;&#8221;)<br />
  F=array(chrw(12468),chrw(12460),chrw(12462),chrw(12464),_<br />
    chrw(12466),chrw(12470),chrw(12472),chrw(12474),_<br />
    chrw(12485),chrw(12487),chrw(12489),chrw(12509),_<br />
    chrw(12505),chrw(12503),chrw(12499),chrw(12497),_<br />
    chrw(12532),chrw(12508),chrw(12506),chrw(12502),_<br />
    chrw(12500),chrw(12496),chrw(12482),chrw(12480),_<br />
    chrw(12478),chrw(12476))<br />
  Jencode=iStr<br />
  for i=0 to 25<br />
   Jencode=replace(Jencode,F(i),E(i))<br />
  next<br />
End Function</p>
<p>解码:</p>
<p>Function Juncode(byVal iStr)<br />
if isnull(iStr) o&#114; isEmpty(iStr) then<br />
  Juncode=&#8221;&#8221;<br />
  Exit function<br />
end if<br />
dim F,i,E</p>
<p>E=array(&#8220;Jn0;&#8221;,&#8221;Jn1;&#8221;,&#8221;Jn2;&#8221;,&#8221;Jn3;&#8221;,&#8221;Jn4;&#8221;,&#8221;Jn5;&#8221;,&#8221;Jn6;&#8221;,&#8221;Jn7;&#8221;,&#8221;Jn8;&#8221;,&#8221;Jn9;&#8221;,</p>
<p>&#8220;Jn10;&#8221;,&#8221;Jn11;&#8221;,&#8221;Jn12;&#8221;,&#8221;Jn13;&#8221;,&#8221;Jn14;&#8221;,&#8221;Jn15;&#8221;,&#8221;Jn16;&#8221;,&#8221;Jn17;&#8221;,&#8221;Jn18;&#8221;,</p>
<p>&#8220;Jn19;&#8221;,&#8221;Jn20;&#8221;,&#8221;Jn21;&#8221;,&#8221;Jn22;&#8221;,&#8221;Jn23;&#8221;,&#8221;Jn24;&#8221;,&#8221;Jn25;&#8221;)<br />
  F=array(chrw(12468),chrw(12460),chrw(12462),chrw(12464),_<br />
    chrw(12466),chrw(12470),chrw(12472),chrw(12474),_<br />
    chrw(12485),chrw(12487),chrw(12489),chrw(12509),_<br />
    chrw(12505),chrw(12503),chrw(12499),chrw(12497),_<br />
    chrw(12532),chrw(12508),chrw(12506),chrw(12502),_<br />
    chrw(12500),chrw(12496),chrw(12482),chrw(12480),_<br />
    chrw(12478),chrw(12476))<br />
  Juncode=iStr<br />
for i=0 to 25<br />
  Juncode=replace(Juncode,E(i),F(i))&#39;□<br />
next<br />
End Function</p>
<p>注意,如果直接使用字符不方便(windows还没装日文支持),注释掉的部分提供有 chr(-23804) </p>
<p>..这样的定义</p>
<p>这样<br />
1.<br />
表单输入保存时,使用Jencode()将这26个字符先编码再保存(为什么是这26个字符,</p>
<p>经过全部测试87个平假名89个片假名最终认定的)<br />
如<br />
ゴ 即 chr(-23116) 编码为 Jn1;<br />
2.<br />
显示时,则使用 Juncode() 函数进行解码,还原日文片假名显示<br />
3.<br />
搜索关键字,也要使用 Jencode() 进行编码后再放入 like里<br />
wh&#101;re [Topic] like &#39;%Jencode(kewwords)%&#39; 使用<br />
才能保证搜索的值和编码过的数据库字段内容匹配</p>
<p>==================================</p>
<p>PS:<br />
也可以使用正则表达式来改写上面的两个函数,或许效率还要更高些<br />
再就是如果 压根不使用日文,也不需要搜索日文,则解码部分可以不用,</p>
<p>保存数据实直接把这26个片假名字符替换为空字符或任一字符,比如&#8221;□&#8221;<br />
抛砖引玉，如果有更本质的真正的好方法，谢分享</p>
<p>附:<br />
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-<br />
平假名87个 asc值<br />
-23391 &#8211;> -23316<br />
unicode 3040-309F </p>
<p>ぁあぃいぅうぇえぉお<br />
かがきぎくぐけげこご<br />
さざしじすずせぜそぞ<br />
ただちぢっつづてでと<br />
どなにぬねのはばぱひ<br />
びぴふぶぷへべぺほぼ<br />
ぽまみむめもゃやゅゆ<br />
ょよらりるれろゎわゐ<br />
ゑをん゛゜ゝゞ<br />
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;<br />
片假名89个 asc值<br />
-23135 -> -23059<br />
unicode 30A0-30FF</p>
<p>ァアィイゥウェエォオ<br />
カガキギクグケゲコゴ<br />
サザシジスズセゼソゾ<br />
タダチヂッツヅテデト<br />
ドナニヌネノハバパヒ<br />
ビピフブプヘベペホボ<br />
ポマミムメモャヤュユ<br />
ョヨラリルレロヮワヰ<br />
ヱヲンヴヵヶーヽヾ</p>
<p>================补充 修改的版本===========================</p>
<p>添加一个编码解码参数codeType<br />
都使用一个函数<br />
使用chr()不直接使用日文字符<br />
这样~ 够简洁了吧？</p>
<p>疑点： 显示日文是不会出错的，保存到数据库也不会出错<br />
只有SQL使用 like 和 inStr 的时候 才会出错 这个与显示无关！<br />
还有在vbs里使用 inStr(1,str,&#8221;aaa&#8221;,1)这样按字符搜索也会错<br />
改为 inStr(lcase(str),&#8221;aaa&#8221;) 就不会出错</p>
<p>如果一定得用  inStr(1,str,&#8221;aaa&#8221;,1) 字符搜索语法<br />
则一定要在先inStr() 后 jncode() 的顺序 否则会出错</p>
<p>一点问题都没有！ 注意到这几点绝对没错！</p>
<p>rs(&#8220;TopicStr&#8221;)=Jncode(TopicStr,true)  &#39;encode 保存到数据库的资料<br />
DisplayStr=Jncode(rs(&#8220;TopicStr&#8221;),false) &#39;uncode &#39;显示到页面的标题</p>
<p>Function Jncode(byVal iStr,codeType)<br />
if isnull(iStr) o&#114; isEmpty(iStr) o&#114; iStr=&#8221;&#8221; then<br />
  Jncode=&#8221;&#8221; : Exit function<br />
end if<br />
dim F,i,E<br />
  E=array(&#8220;Jn0;&#8221;,&#8221;Jn1;&#8221;,&#8221;Jn2;&#8221;,&#8221;Jn3;&#8221;,&#8221;Jn4;&#8221;,&#8221;Jn5;&#8221;,&#8221;Jn6;&#8221;,_<br />
    &#8220;Jn7;&#8221;,&#8221;Jn8;&#8221;,&#8221;Jn9;&#8221;,&#8221;Jn10;&#8221;,&#8221;Jn11;&#8221;,&#8221;Jn12;&#8221;,&#8221;Jn13;&#8221;,_<br />
    &#8220;Jn14;&#8221;,&#8221;Jn15;&#8221;,&#8221;Jn16;&#8221;,&#8221;Jn17;&#8221;,&#8221;Jn18;&#8221;,&#8221;Jn19;&#8221;,&#8221;Jn20;&#8221;,_<br />
    &#8220;Jn21;&#8221;,&#8221;Jn22;&#8221;,&#8221;Jn23;&#8221;,&#8221;Jn24;&#8221;,&#8221;Jn25;&#8221;)<br />
  F=array(chrw(12468),chrw(12460),chrw(12462),chrw(12464),_<br />
    chrw(12466),chrw(12470),chrw(12472),chrw(12474),_<br />
    chrw(12485),chrw(12487),chrw(12489),chrw(12509),_<br />
    chrw(12505),chrw(12503),chrw(12499),chrw(12497),_<br />
    chrw(12532),chrw(12508),chrw(12506),chrw(12502),_<br />
    chrw(12500),chrw(12496),chrw(12482),chrw(12480),_<br />
    chrw(12478),chrw(12476))<br />
if codyType then<br />
   for i=0 to 25 iStr=replace(iStr,F(i),E(i)) next<br />
else<br />
   for i=0 to 25 iStr=replace(iStr,E(i),F(i)) next<br />
end if<br />
Jncode=iStr<br />
End Function</p>
<p>附最简单的方法：<br />
改查询语句，用InStr(1,LCase(columnName),LCase(&#39;&#8221;&amp;keyword&amp;&#8221;&#39;),0)<>0来替代Like语句。<br />
经过本人实验，可用。</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='http://2.gravatar.com/avatar/b9f7391bdaee9d0a30a3fda8ddd6436e?s=49&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/b9f7391bdaee9d0a30a3fda8ddd6436e?s=98&amp;d=mm&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">作者 </span> <a class="url fn n" href="/blog/author/lee">Lee</a></span></span><span class="posted-on"><span class="screen-reader-text">发布于 </span><a href="/blog/2008/121.html" rel="bookmark"><time class="entry-date published" datetime="2008-02-19T18:26:30+00:00">2008年2月19日</time><time class="updated" datetime="-001-11-30T00:00:00+00:00">-0001年11月30日</time></a></span><span class="cat-links"><span class="screen-reader-text">分类 </span><a href="/blog/category/web_development" rel="category tag">网站技术</a></span><span class="comments-link"><a href="/blog/2008/121.html#respond"><span class="screen-reader-text">于26个日文片假名导致Access搜索(80040e14/内存溢出)的解决办法</span>留下评论</a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-118" class="post-118 post type-post status-publish format-standard hentry category-entertainment">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="/blog/2007/118.html" rel="bookmark">[视频]电影《投名状》（刺马）7分钟超长精彩片花</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>　　由陈可辛执导、李连杰、刘德华和金城武主演的电影《投名状》（又称：刺马）即将于12月12日18时开始全面上映。<br />
　　大家先看看片花：<br />
[swf]http://vhead.blog.sina.com.cn/player/bnplayer.swf?vid=http://vhead.blog.sina.com.cn/player/outer_player.swf?auto=0&amp;vid=8704696&amp;uid=1290055681&amp;chn1=28&amp;ref=http%3A%2F%2Fbn.sina.com.cn%2Fent%2Fm%2Fc%2F2007-11-26%2F18265157.shtml&amp;title=%E8%A7%86%E9%A2%91%EF%BC%9A%E3%80%8A%E6%8A%95%E5%90%8D%E7%8A%B6%E3%80%8B7%E5%88%86%E9%92%9F%E8%B6%85%E9%95%BF%E7%B2%BE%E5%BD%A9%E7%89%87%E8%8A%B1%E9%9C%87%E6%92%BC%E9%A6%96%E5%8F%91&amp;auto=1&amp;src=1000831789[/swf]</p>
<p>　　作为今年贺岁档最受期待的大片，《投名状》的登场，也将陆续揭开关于这部电影的四大悬念。　　</p>
<p>　　悬念一：《投名状》到底惨烈到什么程度？</p>
<p>　　《投名状》的导演陈可辛一直认为，拍古装片最重要的是贴近现实，即使《投名状》的武术指导是有“威亚王”之称的程小东，也严禁用威亚，不能乱飞，不能有武侠招式，不能以一敌百却毫发未伤，动作要快，要狠，血肉模糊。无论是打劫太平军，洗劫山村，还是李连杰等成立的“山字营”屠城场面，都有血有肉。其中一幕，金城武更以其擅长的短匕首割掉敌方首领的人头，拿在手上向敌人示威，堪称经典之作。</p>
<p>　　悬念二：片酬一亿的李连杰如何脱胎换骨？</p>
<p>　　片方此前公布李连杰出演该片的片酬是1亿元人民币，是其他三位主演片酬总和的三倍多，据说这些信息的披露曾经引起过三位男主演的失和。但是从最后的结果来看，李连杰无疑是主角之中的主角。李连杰曾说“庞青云”是自己电影生涯中最难猜、最难琢磨、最不接近自己的一个角色，因为他对权力、对兄弟、对爱情的态度都很复杂。李连杰在片中有很多近镜头，但是却经常面无表情，观众捉摸不透他到底是什么情绪。也许就因为这个角色太不像李连杰自己了，所以他的表演倒符合了“亦奸亦忠”的定义。很多看过该片的人士也表示，李连杰在《投名状》中的表演是脱胎换骨式的。</p>
<p>　　悬念三：兄弟的恩怨情仇有多少种拍法？</p>
<p>　　《投名状》开拍前，导演陈可辛曾经说过是翻拍已故导演张彻的《刺马》，不过，最近又改口说故事和背景都不同，总之，都是三个结义兄弟间的恩怨情仇，是换汤不换药。</p>
<p>　　“投名状”源自《水浒传》中，宋朝八十万禁军教头林冲投奔梁山的情节。相传古人在结盟时，会以鲜血立誓，表达其诚信不渝，不能同生，但愿同死的精神。所谓“但凡好汉们入伙，需要纳投名状”，在古代，“投名状”即是结拜誓词。</p>
<p>　　说到《投名状》和《水浒传》的关系，也不是后者仅仅为前者提供了片名这么简单，其中的兄弟恩怨，也没有脱离《水浒传》中的兄弟、兄嫂关系的套路——西门庆、武大郎、武松如果当初“纳投名状”，就是现在《投名状》中兄弟关系的雏形。</p>
<p>　　悬念四：结义三兄弟谁是好人谁是坏人？</p>
<p>　　电影有正面人物和反面人物之分，《投名状》中，结义三兄弟谁是好人谁是坏人？尽管李连杰做了很多残酷而有野心的决定，可是直到他被金城武“就地正法”之后，观众还是不能判断他究竟是好人还是坏人，因为背后牵扯的是那样错综复杂的政治关系。也许一切就像刘德华在片中所说的那样：“做坏人要杀人，但我没想到做好人也要杀人。”而影片的后半段也几乎把所有的笔墨都花在了这上面，因为利益关系而在一个很特殊氛围中结合在一起的三兄弟，最终在内力和外力的作用下土崩瓦解。</p>
<p>　　四大人物简介：</p>
<p>　　李连杰：李连杰饰演的庞青云，兵败之后投靠山贼，与匪帮首领赵二虎和姜午阳立“投名状”结义，青云借二虎之力成立“山字营”以集结军力，大权在握后不惜设计离间兄弟，下毒手杀害赵二虎。</p>
<p>　　刘德华：刘德华饰演匪帮首领赵二虎，在一场围攻苏州城的战役中，他成功说服敌方投降献城，但庞青云为斩草除根，竟下令坑杀数千俘虏，陷赵二虎于不义。</p>
<p>　　金城武：金城武饰演的姜午阳，十三岁便跟随赵二虎，性格刚烈。视兄弟情比生命更重要。为替义兄讨回公道，在庞青云就任江苏巡抚大典上，行刺对方。</p>
<p>　　徐静蕾：徐静蕾饰演的莲生，当年被赵二虎所救。成为赵妻后，虽不用再当歌妓，但山寨夫人的生活并非她所愿。不能扮美女，徐静蕾经常要涂黑脸，她还自己安慰自己说，想不到自己也有另一种美。</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='http://2.gravatar.com/avatar/b9f7391bdaee9d0a30a3fda8ddd6436e?s=49&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/b9f7391bdaee9d0a30a3fda8ddd6436e?s=98&amp;d=mm&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">作者 </span> <a class="url fn n" href="/blog/author/lee">Lee</a></span></span><span class="posted-on"><span class="screen-reader-text">发布于 </span><a href="/blog/2007/118.html" rel="bookmark"><time class="entry-date published" datetime="2007-12-08T22:00:22+00:00">2007年12月8日</time><time class="updated" datetime="-001-11-30T00:00:00+00:00">-0001年11月30日</time></a></span><span class="cat-links"><span class="screen-reader-text">分类 </span><a href="/blog/category/entertainment" rel="category tag">影音娱乐</a></span><span class="comments-link"><a href="/blog/2007/118.html#respond"><span class="screen-reader-text">于[视频]电影《投名状》（刺马）7分钟超长精彩片花</span>留下评论</a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

	<nav class="navigation pagination" role="navigation">
		<h2 class="screen-reader-text">文章导航</h2>
		<div class="nav-links"><a class="prev page-numbers" href="/blog/author/lee/page/17">上一页</a>
<a class='page-numbers' href='/blog/author/lee'><span class="meta-nav screen-reader-text">页 </span>1</a>
<span class="page-numbers dots">&hellip;</span>
<a class='page-numbers' href='/blog/author/lee/page/17'><span class="meta-nav screen-reader-text">页 </span>17</a>
<span class='page-numbers current'><span class="meta-nav screen-reader-text">页 </span>18</span>
<a class='page-numbers' href='/blog/author/lee/page/19'><span class="meta-nav screen-reader-text">页 </span>19</a>
<span class="page-numbers dots">&hellip;</span>
<a class='page-numbers' href='/blog/author/lee/page/30'><span class="meta-nav screen-reader-text">页 </span>30</a>
<a class="next page-numbers" href="/blog/author/lee/page/19">下一页</a></div>
	</nav>
		</main><!-- .site-main -->
	</div><!-- .content-area -->


	<aside id="secondary" class="sidebar widget-area" role="complementary">
		<section id="search-2" class="widget widget_search">
<form role="search" method="get" class="search-form" action="/">
	<label>
		<span class="screen-reader-text">搜索：</span>
		<input type="search" class="search-field" placeholder="搜索…" value="" name="s" />
	</label>
	<button type="submit" class="search-submit"><span class="screen-reader-text">搜索</span></button>
</form>
</section>		<section id="recent-posts-2" class="widget widget_recent_entries">		<h2 class="widget-title">近期文章</h2>		<ul>
					<li>
				<a href="/blog/2016/307.html">curl与file_get_contents访问远程接口慢的解决</a>
						</li>
					<li>
				<a href="/blog/2016/306.html">PHP中Notice: iconv(): Unknown error (84) 的解决办法</a>
						</li>
					<li>
				<a href="/blog/2016/305.html">微信大文件的清理</a>
						</li>
					<li>
				<a href="/blog/2015/304.html">博客貌似被黑了，有空换PHP的</a>
						</li>
					<li>
				<a href="/blog/2014/303.html">使用socket方式连接Nginx优化php-fpm性能</a>
						</li>
				</ul>
		</section>		<section id="recent-comments-2" class="widget widget_recent_comments"><h2 class="widget-title">近期评论</h2><ul id="recentcomments"><li class="recentcomments"><span class="comment-author-link">七月的路人甲</span>发表在《<a href="/blog/2007/57.html#comment-113">看《西游记》悟团队建设</a>》</li><li class="recentcomments"><span class="comment-author-link">七月的路人甲</span>发表在《<a href="/blog/2007/58.html#comment-112">讯时2.70漏洞－对讯时新闻发布系统的艰难突破</a>》</li><li class="recentcomments"><span class="comment-author-link">sunchili</span>发表在《<a href="/blog/2012/208.html#comment-111">VideoShot.exe停止工作的解决办法</a>》</li><li class="recentcomments"><span class="comment-author-link">嫁给风的女孩</span>发表在《<a href="/blog/2012/207.html#comment-109">Jinitiator控件IE崩溃及Jinitiator界面汉字方框的解决办法</a>》</li><li class="recentcomments"><span class="comment-author-link">李三</span>发表在《<a href="/blog/2013/240.html#comment-108">商务领航定制网关(EG692HW)电信管理员密码获取方法</a>》</li></ul></section><section id="archives-2" class="widget widget_archive"><h2 class="widget-title">文章归档</h2>		<ul>
			<li><a href='/blog/date/2016/01'>2016年一月</a></li>
	<li><a href='/blog/date/2015/09'>2015年九月</a></li>
	<li><a href='/blog/date/2014/11'>2014年十一月</a></li>
	<li><a href='/blog/date/2014/10'>2014年十月</a></li>
	<li><a href='/blog/date/2014/07'>2014年七月</a></li>
	<li><a href='/blog/date/2014/06'>2014年六月</a></li>
	<li><a href='/blog/date/2014/05'>2014年五月</a></li>
	<li><a href='/blog/date/2014/04'>2014年四月</a></li>
	<li><a href='/blog/date/2014/03'>2014年三月</a></li>
	<li><a href='/blog/date/2014/02'>2014年二月</a></li>
	<li><a href='/blog/date/2014/01'>2014年一月</a></li>
	<li><a href='/blog/date/2013/12'>2013年十二月</a></li>
	<li><a href='/blog/date/2013/09'>2013年九月</a></li>
	<li><a href='/blog/date/2013/08'>2013年八月</a></li>
	<li><a href='/blog/date/2013/07'>2013年七月</a></li>
	<li><a href='/blog/date/2013/06'>2013年六月</a></li>
	<li><a href='/blog/date/2013/05'>2013年五月</a></li>
	<li><a href='/blog/date/2013/04'>2013年四月</a></li>
	<li><a href='/blog/date/2012/12'>2012年十二月</a></li>
	<li><a href='/blog/date/2012/11'>2012年十一月</a></li>
	<li><a href='/blog/date/2012/09'>2012年九月</a></li>
	<li><a href='/blog/date/2012/08'>2012年八月</a></li>
	<li><a href='/blog/date/2012/07'>2012年七月</a></li>
	<li><a href='/blog/date/2012/06'>2012年六月</a></li>
	<li><a href='/blog/date/2012/05'>2012年五月</a></li>
	<li><a href='/blog/date/2012/04'>2012年四月</a></li>
	<li><a href='/blog/date/2012/03'>2012年三月</a></li>
	<li><a href='/blog/date/2012/01'>2012年一月</a></li>
	<li><a href='/blog/date/2011/11'>2011年十一月</a></li>
	<li><a href='/blog/date/2011/09'>2011年九月</a></li>
	<li><a href='/blog/date/2011/08'>2011年八月</a></li>
	<li><a href='/blog/date/2011/07'>2011年七月</a></li>
	<li><a href='/blog/date/2011/02'>2011年二月</a></li>
	<li><a href='/blog/date/2010/09'>2010年九月</a></li>
	<li><a href='/blog/date/2010/08'>2010年八月</a></li>
	<li><a href='/blog/date/2010/07'>2010年七月</a></li>
	<li><a href='/blog/date/2010/06'>2010年六月</a></li>
	<li><a href='/blog/date/2009/12'>2009年十二月</a></li>
	<li><a href='/blog/date/2009/10'>2009年十月</a></li>
	<li><a href='/blog/date/2009/08'>2009年八月</a></li>
	<li><a href='/blog/date/2009/06'>2009年六月</a></li>
	<li><a href='/blog/date/2009/05'>2009年五月</a></li>
	<li><a href='/blog/date/2009/04'>2009年四月</a></li>
	<li><a href='/blog/date/2009/03'>2009年三月</a></li>
	<li><a href='/blog/date/2009/01'>2009年一月</a></li>
	<li><a href='/blog/date/2008/12'>2008年十二月</a></li>
	<li><a href='/blog/date/2008/11'>2008年十一月</a></li>
	<li><a href='/blog/date/2008/10'>2008年十月</a></li>
	<li><a href='/blog/date/2008/09'>2008年九月</a></li>
	<li><a href='/blog/date/2008/08'>2008年八月</a></li>
	<li><a href='/blog/date/2008/07'>2008年七月</a></li>
	<li><a href='/blog/date/2008/06'>2008年六月</a></li>
	<li><a href='/blog/date/2008/04'>2008年四月</a></li>
	<li><a href='/blog/date/2008/02'>2008年二月</a></li>
	<li><a href='/blog/date/2007/12'>2007年十二月</a></li>
	<li><a href='/blog/date/2007/11'>2007年十一月</a></li>
	<li><a href='/blog/date/2007/10'>2007年十月</a></li>
	<li><a href='/blog/date/2007/09'>2007年九月</a></li>
	<li><a href='/blog/date/2007/08'>2007年八月</a></li>
	<li><a href='/blog/date/2007/07'>2007年七月</a></li>
	<li><a href='/blog/date/2007/06'>2007年六月</a></li>
	<li><a href='/blog/date/2007/05'>2007年五月</a></li>
	<li><a href='/blog/date/2007/04'>2007年四月</a></li>
		</ul>
		</section><section id="categories-2" class="widget widget_categories"><h2 class="widget-title">分类目录</h2>		<ul>
	<li class="cat-item cat-item-16"><a href="/blog/category/dotnet" >.Net</a>
</li>
	<li class="cat-item cat-item-8"><a href="/blog/category/pc_technology" >PC技术</a>
</li>
	<li class="cat-item cat-item-11"><a href="/blog/category/entertainment" >影音娱乐</a>
</li>
	<li class="cat-item cat-item-15"><a href="/blog/category/database" >数据库</a>
</li>
	<li class="cat-item cat-item-14"><a href="/blog/category/digest" >文摘</a>
</li>
	<li class="cat-item cat-item-13"><a href="/blog/category/orther" >杂货铺</a>
</li>
	<li class="cat-item cat-item-7"><a href="/blog/category/management" >管理营运</a>
</li>
	<li class="cat-item cat-item-9"><a href="/blog/category/web_development" >网站技术</a>
</li>
	<li class="cat-item cat-item-3"><a href="/blog/category/network" >网络安全</a>
</li>
	<li class="cat-item cat-item-4"><a href="/blog/category/life" >网络生活</a>
</li>
		</ul>
</section><section id="meta-2" class="widget widget_meta"><h2 class="widget-title">功能</h2>			<ul>
						<li><a href="/wp-login.php">登录</a></li>
			<li><a href="/feed">文章<abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="/comments/feed">评论<abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="https://cn.wordpress.org/" title="基于WordPress，一个优美、先进的个人信息发布平台。">WordPress.org</a></li>			</ul>
			</section>	</aside><!-- .sidebar .widget-area -->

		</div><!-- .site-content -->

		<footer id="colophon" class="site-footer" role="contentinfo">
							<nav class="main-navigation" role="navigation" aria-label="页脚主菜单">
					<div class="menu-%e5%af%bc%e8%88%aa-container"><ul id="menu-%e5%af%bc%e8%88%aa-1" class="primary-menu"><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-309"><a href="/blog/category/web_development">网站技术</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-310"><a href="/blog/category/pc_technology">PC技术</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-311"><a href="/blog/category/orther">杂货铺</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-312"><a href="/blog/category/entertainment">影音娱乐</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-313"><a href="/blog/category/life">网络生活</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-314"><a href="/blog/category/digest">文摘</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-315"><a href="/blog/category/database">数据库</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-316"><a href="/blog/category/network">网络安全</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-317"><a href="/blog/category/management">管理营运</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-318"><a href="/blog/category/dotnet">.Net</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-323"><a href="/about_me">关于我</a></li>
</ul></div>				</nav><!-- .main-navigation -->
			
			
			<div class="site-info">
								<span class="site-title"><a href="/" rel="home">网站建设技术集锦</a></span>
				<a href="https://cn.wordpress.org/">自豪地采用WordPress</a>
			</div><!-- .site-info -->
		</footer><!-- .site-footer -->
	</div><!-- .site-inner -->
</div><!-- .site -->

<script type='text/javascript' src='/wp-content/themes/twentysixteen/js/skip-link-focus-fix.js?ver=20160816'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var screenReaderText = {"expand":"\u5c55\u5f00\u5b50\u83dc\u5355","collapse":"\u6298\u53e0\u5b50\u83dc\u5355"};
/* ]]> */
</script>
<script type='text/javascript' src='/wp-content/themes/twentysixteen/js/functions.js?ver=20160816'></script>
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=4.6'></script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?6b862532551ab821a572e486bca05514";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
</body>
</html>
